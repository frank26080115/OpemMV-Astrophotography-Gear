<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="initial-scale=1" />
<title>OpenMV AutoGuider</title>

<!-- ignore -->
<script type="application/javascript" src="web/jquery-3.5.1.min.js"></script>
<script type="application/javascript" src="web/jquery-ui-1.12.1.min.js"></script>
<script type="application/javascript" src="web/toast.js"></script>
<script type="application/javascript" src="web/chartist.min.js"></script>
<script type="application/javascript" src="web/mathutils.js"></script>
<script type="application/javascript" src="web/websocketutils.js"></script>
<script type="application/javascript" src="web/autoguider_utils.js"></script>
<script type="application/javascript" src="web/draw_guideerror.js"></script>
<script type="application/javascript" src="web/draw_starprofile.js"></script>
<script type="application/javascript" src="web/draw_guidescope.js"></script>
<script type="application/javascript" src="web/autoguider_test.js"></script>
<link rel="stylesheet" href="web/jquery-ui-1.12.1-darkness.css" />
<link rel="stylesheet" href="web/chartist.min.css" />
<link rel="stylesheet" href="web/divtable_basic.css" />
<!-- end ignore -->

<link rel="shortcut icon" href="data:image/x-icon;base64,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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAADAAAABgAAAAAQAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADs7Ow1HR0dzSEdH5khHR+ZHR0dzOzs7DQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEZGRldJRkbvSUdH/0lHR/9JRkbvSUZGVwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUlHR5dJR0f/SUdH/0lHR/9JR0f/SUdHlwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUpHR59JR0f/SUdH/0lHR/9JR0f/SkdHnwAA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RoBVVVUGAAAAADRI3ic3StvdN0rb/zdK2/83Stv/N0rb/zdK2/83Stv/N0rb/zdK2/83StvdM0bZKAAAAABVVVUGSUdHgUlHR/RJR0f+SUdH/0lHR/9JR0f/SUdH/0lHR/9JR0f/SUdH/0lHR/9JR0f/SUdH/0lHR/9JR0fvSEZGeEhHR+VJR0f/SUdH/0lHR/9JR0f/SUdH/0lHR/9JR0f/SUdH/0lHR/9JR0f/SUdH/0lHR/9JR0f/SUdH/0lHR9VISEggAAAAADhI20A3Stv2N0rb/zdK2/83Stv/N0rb/zdK2/83Stv/N0rb/zdK2/83Sdv3NUjdQwAAAABGRkYhSUdH1UlHR/9JR0f/SUdH/0lHR/9JR0f/SUdH/0lHR/9JR0f/SUdH/0lHR/9JR0f/SUdH/0lHR/9JR0f/SUdH5UlHR+ZJR0f/SUdH/0lHR/9JR0f/SUdH/0lHR/9JR0f/SUdH/0lHR/9JR0f/SUdH/0lHR/9JR0f/SUdH/0lHR9RISEggAAAAADVI3UM3Stv3N0rb/zdK2/83Stv/N0rb/zdK2/83Stv/N0rb/zdK2/83Stv3NUjZQwAAAABISEggSUdH1ElHR/9JR0f/SUdH/0lHR/9JR0f/SUdH/0lHR/9JR0f/SUdH/0lHR/9JR0f/SUdH/0lHR/9JR0f/SUdH5UlHR3dJR0ftSUdH/0lHR/9JR0f/SUdH/0lHR/9JR0f/SUdH/0lHR/9JR0f/SUdH/0lHR/9JR0f+SUdH8khGRn9VKioGAAAAADdJ2yo2StvhN0rb/zdK2/83Stv/N0rb/zdK2/83Stv/N0rb/zdK2/82StvhN0nbKgAAAABVKioGSUdHfklHR/JJR0f+SUdH/0lHR/9JR0f/SUdH/0lHR/9JR0f/SUdH/0lHR/9JR0f/SUdH/0lHR/9JR0ftSUdHdlVAQAxJRkZUSkZGmEhGRqdIRkanSEdHxUlHR/5JR0f/SUdH/0lHR/9JR0f1SUZGtUhHR6ZIRkaYSEREUkBAQAwAAAAAAAAAADNE3Q82SdukN0rb/TdK2/83Stv/N0rb/zdK2/83Stv/N0rb/zdK2/02S9ukM0TdDwAAAAAAAAAAQEBADEhERFJIRkaYSEdHpklGRrJIR0fwSUdH/0lHR/9JR0f/SUdH/0hHR85JRkanSEZGp0pGRphGRkZUQEBADAAA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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEZGRldJRkbvSUdH/0lHR/9JRkbvRkZGVwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADs7Ow1IRUVySUZG3UlGRt1IRkZxOzs7DQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==" />

<style type="text/css">
body
{
    background-color: #000;
    color: #EEE;
    font-size: 10pt;
}
.hideable-msg {
    padding-left: 1em;
    margin-bottom: 10px;
}

.ct-series-a .ct-line, .ct-series-a .ct-point { stroke:#FF4444; }
.ct-series-b .ct-line, .ct-series-b .ct-point { stroke:#4488FF; }
.ct-series-c .ct-area { fill-opacity: 0.5; }
.ct-series-d .ct-line { stroke:#888888; }
.ct-series-d .ct-area { fill:  #888888; fill-opacity: 0.2; }
.ct-series-e .ct-line { stroke:#888888; }
.ct-series-e .ct-area { fill:  #888888; fill-opacity: 0.2; }
.ct-series-f .ct-line { stroke:#FFFFFF; }
span.ct-label.ct-vertical.ct-start { position: relative; top: 4px; }

a:link {
  color: green;
}

a:visited {
  color: green;
}

a:hover {
  color: red;
}

a:active {
  color: yellow;
}

</style>

<script type="text/javascript">

var guide_state = 0;
var interval_state = 0;
var settings = {};
var has_settings = false;
var queuedSettings = [];
var last_status = null;
var last_rx = null;
var noStatUpdate_timer = null;
var first_ever = true;
var session_rand_id = 0;

var selected_star = null, tgt_coord = null, ori_coord = null;

var screen_size_rpt_timer = null;

var guide_state_pretend = 0;
var guide_state_pretend_cnt = 0;
var ignore_next = false;

var last_msg_time = 0;
function handleMsgLogs(obj)
{
    var buff = [];
    var i;
    for (i = 0; i < 10; i++)
    {
        var istr = i.toString();
        if ((('msg_tick_' + istr) in obj) && (('msg_tick_' + istr) in obj) && (('msg_str_' + istr) in obj))
        {
            var itm = {};
            itm["tick"] = obj["msg_tick_" + istr];
            itm["time"] = obj["msg_time_" + istr];
            itm["str"]  = obj["msg_str_"  + istr];
            buff.push(itm);
        }
    }
    buff.sort(function(a, b) {
        return a["tick"] - b["tick"];
    });
    for (i = 0; i < buff.length; i++)
    {
        var itm = buff[i];
        if (itm["time"] > last_msg_time) {
            last_msg_time = itm["time"];
            if (first_ever == false) {
                show_toast_msg(itm["str"]);
                msglog_append("[" + fmtTime(epochToDate(itm["time"])) + "]: " + itm["str"].trim());
            }
        }
    }
}

var last_pulselog_time = 0;
var last_pulse_sum = 0;
var pulse_maxsum = 0;
var pulse_maxsum_cache = 0;
function handlePulseLogs(obj)
{
    var buff = [];
    var i;
    for (i = 0; i < 10; i++)
    {
        var istr = i.toString();
        if ((('pulse_time_' + istr) in obj) && (('pulse_ra_' + istr) in obj) && (('pulse_dec_' + istr) in obj) && (('pulse_sum_' + istr) in obj))
        {
            var itm = {};
            itm["time"] = obj["pulse_time_" + istr];
            itm["ra"]   = obj["pulse_ra_"   + istr];
            itm["dec"]  = obj["pulse_dec_"  + istr];
            itm["sum"]  = obj["pulse_sum_"  + istr];
            itm["shutter"] = obj["pulse_shutter_" + istr];
            buff.push(itm);
        }
    }
    buff.sort(function(a, b) {
        return a["time"] - b["time"];
    });
    for (i = 0; i < buff.length; i++)
    {
        var itm = buff[i];
        if (itm["time"] > last_pulselog_time) {
            last_pulselog_time = itm["time"];
            errgraph_push(itm["time"], itm["ra"], itm["dec"], itm["sum"], itm["shutter"]);
            if (itm["sum"] < last_pulse_sum)
            {
                pulse_maxsum_cache = pulse_maxsum;
                pulse_maxsum = 0;
            }
            if (itm["sum"] > pulse_maxsum) {
                pulse_maxsum = itm["sum"];
            }
            last_pulse_sum = itm["sum"];
        }
    }
}

var calibration = {"ra": null, "dec": null};
function handleCalibration(obj, axis)
{
    var inner = obj["calib_" + axis];
    var ele = document.getElementById("calibinfo_" + axis);
    var ret = false;
    if (inner == null || inner == false)
    {
        calibration[axis] = null;
        ele.innerHTML = "None";
        return false;
    }

    calibration[axis] = inner;

    var txt = "";

    if (inner["success"].includes("fail")) {
        txt += "Calibration has failed.<br />";
    }
    else if (inner["success"].includes("wait")) {
        txt += "Calibration in progress... (or incomplete)<br />";
    }
    else if (inner["success"].includes("init")) {
        txt += "Calibration not started<br />";
    }
    else if (inner["success"].includes("done")) {
        ret = true;
    }

    var t = epochToDate(inner["time"]);
    if (inner["success"].includes("done")) {
        txt += "Time: " + fmtDate(t) + " " + fmtTime(t) + "<br />";
    }
    txt += "Pixels-per-ms = " + inner["pix_per_ms"].toFixed(4) + "<br />";
    txt += "Angle = " + inner["angle"].toFixed(1) + "&deg;<br />";
    if (("points_cnt" in inner) != false) {
        txt += "Points Used: " + inner["points_cnt"].toString() + "<br />";
    }
    //txt += "Starting Coordinates: ( " + inner["start_coord"][0].toFixed(1) + " , " + inner["start_coord"][1].toFixed(1) + " )";
    txt += "Starting Coordinates: ( " + inner["start_x"].toFixed(1) + " , " + inner["start_y"].toFixed(1) + " )";

    if (calibration["ra"] != null && calibration["dec"] != null)
    {
        if (calibration["ra"]["success"] == "done" && calibration["dec"]["success"] == "done")
        {
            if (math_isNear90Apart(math_getAngleDiff(calibration["ra"]["angle"], calibration["dec"]["angle"]), 5) == false)
            {
                txt += "<br />Warning: the angle between R.A. and Dec. is not perpendicular";
            }
        }
    }

    ele.innerHTML = txt;

    return ret;
}

function queueSettingsUpdate(key, val)
{
    settings[key] = val;
    if (queuedSettings.includes(key) == false)
    {
        queuedSettings.push(key);
    }
}

function sendNewSettings()
{
    if (queuedSettings.length <= 0) {
        return;
    }
    var obj = {"pkt_type": "settings", "time": time_getNowEpoch()};
    queuedSettings.forEach(function (itm, idx) {
        if ((itm in settings) != false) {
            obj[itm] = settings[itm];
        }
    });
    queuedSettings = [];
    //websock_ping_delay();
    websock_send(obj);
}

function onLoadAll()
{
    document.getElementById("loading").style.display = "none";
    document.getElementById("showme") .style.display = "none";

    $( "#accordion" ).accordion({heightStyle: "content"});
    $( "#accordion" ).on( "accordionactivate", function( event, ui ) { hideAllHelp(); } );

    make_ui_mainctrl()
    make_ui_intervalometer();
    make_ui_guidecamconfig();
    make_ui_mountconfig();
    make_ui_calibration();
    make_ui_analysisparameters();
    make_ui_advflt();
    make_ui_hotpixels();
    make_ui_console();

    $(window).on('resize', function(e) {
        errgraph_onresize();
        draw_guidescope(last_status);

        // use a timer to prevent spamming window resize events
        if (screen_size_rpt_timer != null) {
            clearTimeout(screen_size_rpt_timer);
            screen_size_rpt_timer = null;
        }
        screen_size_rpt_timer = setTimeout(function() {
            msglog_appendLocal("screen size: " + window.innerWidth + " x " + window.innerHeight);
            clearTimeout(screen_size_rpt_timer);
            screen_size_rpt_timer = null;
        }, 2000);
    });

    websocket_init("websocket");
    document.getElementById("loading_connecting").style.display = "block";
}

var websock_total_err = 0;

function websock_onerror(evt)
{
    if (websock_total_err == 0)
    {
        show_toast_msg("ERR: web-socket error");
        if (evt.message !== undefined && typeof evt.message !== 'undefined') {
            msglog_appendLocal("WEBSOCK ERR: " + evt.message);
        }
        else {
            msglog_appendLocal("WEBSOCK ERR");
        }
    }
    document.getElementById("connection_lost").style.display = "block";
    websock_total_err += 1;
    if (websock_total_err > 3 && last_status == null) {
        document.getElementById("loading_failed").style.display = "block";
        document.getElementById("showme").style.display = "none";
    }
    else {
        setTimeout(function() { websocket_init("websocket"); }, 2000);
    }
}

function websock_onopen(evt)
{
    websock_total_err = 0;
    document.getElementById("connection_lost").style.display = "none";
    msglog_appendLocal("websocket opened!");
    document.getElementById("loading").style.display = "none";
    document.getElementById("loading_connecting").style.display = "none";
    if (websock_retransmit() == false)
    {
        miscCmd("getsettings");
        document.getElementById("loading_settings").style.display = "block";
    }
    if (last_status != null)
    {
        show_toast_msg("SUCCESS: web-socket reconnected");
    }

    if (noStatUpdate_timer != null) {
        clearTimeout(noStatUpdate_timer);
    }
    noStatUpdate_timer = setTimeout(noStatUpdate, 6000);
}

function websock_onmessage_jsonobj(obj)
{
    last_rx = obj;
    setTimeout(websock_onmessage_jsonobj_inner, 1);
    // found out the hard way that the thread that runs these onmessage callback functions will timeout and cut the function short without any notification
    // so the solution is to just save the object and run the function in another thread that doesn't unexpectedly quit
}

function websock_onmessage_jsonobj_inner()
{
    var obj = last_rx;

    websock_total_err = 0;
    if (queuedSettings.length > 0)
    {
        sendNewSettings();
    }
    else
    {
        //websock_ping_delay();
    }

    document.getElementById("connection_lost").style.display = "none";
    if (obj["pkt_type"] == "settings")
    {
        document.getElementById("loading_settings").style.display = "none";
        document.getElementById("loading_almost").style.display = "block";
        autoFillSettingsUi(obj);
        fillAdvFilterSettings(obj);
        settings = obj;
        has_settings = true;
    }
    else if (obj["pkt_type"] == "status" || obj["pkt_type"] == "state")
    {
        console.log("obtained status obj");
        document.getElementById("loading_almost").style.display = "none";
        document.getElementById("loading_settings").style.display = "none";

        if (ignore_next == false) {
            last_status = obj;
            handleStateObj();
        }
        ignore_next = false;

        if (has_settings == false) {
            miscCmd("getsettings");
        }
    }
    else if (obj["pkt_type"] == "stars")
    {
        star_list = parseStarsStr(obj["stars"]);
        draw_guidescope();
    }
    else if (obj["pkt_type"] == "logs")
    {
        handleMsgLogs(obj);
        handlePulseLogs(obj);
    }
    else
    {
        if ("pkt_type" in obj) {
            console.log("obtained unknown obj with pkt_type: " + obj["pkt_type"]);
        }
        else {
            console.log("obtained unknown obj without pkt_type");
        }
    }
}

function handleStateObj()
{
    document.getElementById("loading").style.display = "none";
    document.getElementById("showme").style.display = "block";

    var obj = last_status;

    var can_start =
    handleCalibration(obj, "ra");
    handleCalibration(obj, "dec");

    if (("session_rand_id" in obj) != false) {
        var nid = obj["session_rand_id"];
        if (nid != session_rand_id) {
            errgraph_clear();
            last_pulselog_time = 0;
            last_msg_time = 0;
            session_rand_id = nid;
        }
    }

    if (("logs" in obj) != false) {
        handleMsgLogs(obj["logs"]);
        handlePulseLogs(obj["logs"]);
    }

    if (obj["stars"] != null && obj["stars"] != false) {
        star_list = parseStarsStr(obj["stars"]);
    }
    imageStatsUpdate(obj);
    hotpixelsInfoUpdate(obj);

    if (("interval_state" in obj) && ("blub_remaining" in obj))
    {
        interval_state = obj["interval_state"];
        if (intervalometer_pretend_status != interval_state && intervalometer_pretend_status >= 0)
        {
            if (intervalometer_pretend_status == INTERVALSTATE_HALT && interval_state == INTERVALSTATE_IDLE) {
                intervalometer_pretend_status = INTERVALSTATE_IDLE;
            }
            if (intervalometer_pretend_status == INTERVALSTATE_BULB_TEST && interval_state == INTERVALSTATE_SINGLE_ENDING) {
                intervalometer_pretend_status = INTERVALSTATE_SINGLE_ENDING;
                if (obj["blub_remaining"] > 0) {
                    intervalometer_remaining = obj["blub_remaining"];
                }
            }
            if (intervalometer_status_mismatch < 3) {
                intervalometerUpdate(intervalometer_pretend_status, intervalometer_remaining);
                intervalometer_status_mismatch += 1;
            }
            else {
                intervalometerUpdate(interval_state, obj["blub_remaining"]);
                intervalometer_status_mismatch = 0;
                intervalometer_pretend_status = -1;
            }
        }
        else {
            intervalometerUpdate(interval_state, obj["blub_remaining"]);
            intervalometer_status_mismatch = 0;
            intervalometer_pretend_status = -1;
        }
    }
    else {
        console.log("intervalometer data missing from status");
    }

    var has_selectedstar = false;
    if (("sel_star" in obj) != false) {
        if (obj["sel_star"] != false && obj["sel_star"] != null) {
            has_selectedstar = true;
            selected_star = obj["sel_star"];
            pending_select = null;
        }
    }
    if (has_selectedstar == false) {
        selected_star = null;
    }
    if (has_selectedstar != false && ("sel_star_profile" in obj) != false) {
        document.getElementById("div_starprofile").style.display = "block";
        starprofile = obj["sel_star_profile"];
        draw_starprofile();
    }
    else {
        document.getElementById("div_starprofile").style.display = "none";
        starprofile = [];
        draw_starprofile();
    }

    var has_tgtstar = false;
    if (("tgt_coord" in obj) != false) {
        if (obj["tgt_coord"] != false && obj["tgt_coord"] != null) {
            has_tgtstar = true;
            tgt_coord = obj["tgt_coord"];
        }
    }
    if (has_tgtstar == false) {
        tgt_coord = null;
    }

    has_tgtstar = false;
    if (("ori_coord" in obj) != false) {
        if (obj["ori_coord"] != false && obj["ori_coord"] != null) {
            has_tgtstar = true;
            ori_coord = obj["ori_coord"];
        }
    }
    if (has_tgtstar == false) {
        ori_coord = null;
    }

    var is_dither = (settings["dither_amount"] > 0 && (guide_state == 1 || guide_state == 2) && (interval_state == 1 || interval_state == 2));
    if (is_dither)
    {
        if (("dither_interval" in obj) != false)
        {
            var total = settings["dither_interval"];
            if (total < 1) { total = 1; };
            var i = obj["dither_interval"] + 1;
            var txt = "";
            if (guide_state != GUIDESTATE_DITHER) {
                txt += i.toString() + " / ";
            }
            else {
                txt += total.toString() + " / ";
            }
            txt += total.toString() + " in dithering group";
            document.getElementById("dither_status").style.display = "block";
            document.getElementById("dither_status").innerHTML = txt;
        }
    }
    else {
        document.getElementById("dither_status").style.display = "none";
    }

    var infoele = document.getElementById("div_statusinfo");
    var txt = "";
    guide_state = obj["guide_state"];
    var ui_guide_state = guide_state;
    if (guide_state_pretend != guide_state) {
        guide_state_pretend_cnt += 1;
        if (guide_state_pretend_cnt < 3) {
            ui_guide_state = guide_state_pretend;
        }
        else {
            guide_state_pretend = guide_state;
            guide_state_pretend_cnt = 0;
        }
    }
    else {
        guide_state_pretend = guide_state;
        guide_state_pretend_cnt = 0;
    }

    if (ui_guide_state == GUIDESTATE_IDLE)
    {
        txt = "IDLE";
        ui_list["btn_guideend"       ].button("option", "disabled", true);
        ui_list["btn_guidestart"     ].button("option", "disabled", can_start == false);
        ui_list["btn_calib_ra"       ].button("option", "disabled", false);
        ui_list["btn_calib_dec"      ].button("option", "disabled", false);
        ui_list["btn_gotocalibration"].button("option", "disabled", false);
        ui_list["btn_streamimg"      ].button("option", "disabled", false);
        ui_list["btn_streamimg_star" ].button("option", "disabled", false);
        ui_list["btn_hotpixels"      ].button("option", "disabled", false);
        //ui_list["btn_advfilt_update" ].button("option", "disabled", false);
        //ui_list["btn_advfilt_reset"  ].button("option", "disabled", false);
        enable_testpulsebtns();
    }
    else
    {
        ui_list["btn_guideend"  ].button("option", "disabled", false);
        disable_testpulsebtns();
        if (ui_guide_state == GUIDESTATE_PANIC)
        {
            txt = "PANIC";
            ui_list["btn_guidestart"     ].button("option", "disabled", can_start == false);
            ui_list["btn_calib_ra"       ].button("option", "disabled", true);
            ui_list["btn_calib_dec"      ].button("option", "disabled", true);
            ui_list["btn_gotocalibration"].button("option", "disabled", true);
            ui_list["btn_streamimg"      ].button("option", "disabled", false);
            ui_list["btn_streamimg_star" ].button("option", "disabled", false);
            ui_list["btn_hotpixels"      ].button("option", "disabled", false);
            //ui_list["btn_advfilt_update" ].button("option", "disabled", false);
            //ui_list["btn_advfilt_reset"  ].button("option", "disabled", false);
        }
        else
        {
            ui_list["btn_guidestart"     ].button("option", "disabled", true);
            ui_list["btn_calib_ra"       ].button("option", "disabled", true);
            ui_list["btn_calib_dec"      ].button("option", "disabled", true);
            ui_list["btn_gotocalibration"].button("option", "disabled", true);
            ui_list["btn_streamimg"      ].button("option", "disabled", true);
            ui_list["btn_streamimg_star" ].button("option", "disabled", true);
            ui_list["btn_hotpixels"      ].button("option", "disabled", true);
            //ui_list["btn_advfilt_update" ].button("option", "disabled", true);
            //ui_list["btn_advfilt_reset"  ].button("option", "disabled", true);
            if (ui_guide_state == GUIDESTATE_GUIDING) {
                txt = "auto-guiding";
            }
            else if (ui_guide_state == GUIDESTATE_DITHER) {
                txt = "auto-guiding (dithering)";
            }
            else if (ui_guide_state == GUIDESTATE_CALIBRATING_RA) {
                txt = "calibrating R.A.";
                if (viz_calib == 0) {
                    viz_calib = 1;
                }
                else if (viz_calib == 2) {
                    viz_calib = 3;
                }
            }
            else if (ui_guide_state == GUIDESTATE_CALIBRATING_DEC) {
                txt = "calibrating dec.";
                if (viz_calib == 0) {
                    viz_calib = 2;
                }
                else if (viz_calib == 1) {
                    viz_calib = 3;
                }
            }
            else {
                txt = "status: unknown";
            }
        }
    }
    txt = "<b>" + txt.toUpperCase() + "</b>";
    if (selected_star != null) {
        txt += "<br />selected star:<br />&nbsp;&nbsp;&nbsp;&nbsp;x=" + selected_star[0].toFixed(1) + " , y=" + selected_star[1].toFixed(1);
    }
    txt += "<br />stars seen: " + (star_list.length).toString();
    if (guide_state == GUIDESTATE_GUIDING && intervalometer_status != INTERVALSTATE_IDLE) {
        txt += "<br />drift sum: " + pulse_maxsum.toString();// + "<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(prev=" + pulse_maxsum_cache.toString() + ")";
    }
    txt += "<br />analysis quality:<br />&nbsp;&nbsp;&nbsp;&nbsp;error=" + obj["last_move_err"] + "&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;matches=" + obj["multistar_cnt"][0] + " (" + Math.round(obj["multistar_cnt"][0] * 100 / star_list.length) + "%)";
    if (settings["multistar_cnt_max"] > 1 || obj["multistar_cnt"][1] > 1) {
        txt += "<br />multi-star used: " + obj["multistar_cnt"][1];
    }
    if (can_start == false) {
        txt += "<br />calibration not complete";
    }
    infoele.innerHTML = txt;

    draw_guidescope(obj);

    if (noStatUpdate_timer != null) {
        clearTimeout(noStatUpdate_timer);
    }
    noStatUpdate_timer = setTimeout(noStatUpdate, 6000);
    first_ever = false;
}

function websock_onmessage_str(data)
{
    websock_total_err = 0;
    //websock_ping_delay();

    if (typeof data === 'string' || data instanceof String)
    {
        if (data.startsWith("file:"))
        {
            var data2 = data.substring(5);
            if (data2.includes(":")) {
                var colonIdx = data2.indexOf(":");
                var eleId    = data2.substring(0, colonIdx);
                var content  = data2.substring(colonIdx + 1);
                document.getElementById(eleId).innerHTML = content;
            }
        }
    }
}

function noStatUpdate()
{
    if (websock_ping_timer != null) {
        clearTimeout(websock_ping_timer);
    }
    var evt = {"message": "status update timed-out"};
    websock_onerror(evt);
}

var block_auto_queuing = false;

function autoFillSettingsUi(obj)
{
    block_auto_queuing = true;
    for (let key in obj) {
        if ((key in autopopulate_func_list) != false) {
            autopopulate_func_list[key](obj[key]);
        }
    }
    block_auto_queuing = false;
}

function miscCmd(x)
{
    var obj = {}
    obj["pkt_type"] = "misc_cmd";
    obj["time"]     = time_getNowEpoch();
    obj["cmd"]      = x;
    //websock_ping_delay();
    websock_send(obj);
}

function guideCmd(x)
{
    var obj = {}
    obj["pkt_type"] = "guide_cmd";
    obj["time"]     = time_getNowEpoch();
    obj["cmd"]      = x;
    //websock_ping_delay();
    websock_send(obj);
}

function selectStar(x, y)
{
    var obj = {}
    obj["pkt_type"] = "select_star";
    obj["time"]     = time_getNowEpoch();
    obj["star_x"]   = x;
    obj["star_y"]   = y;
    //websock_ping_delay();
    websock_send(obj);
}

function star_onclick(x, y)
{
    if (guide_state == GUIDESTATE_IDLE)
    {
        pending_select = [x, y];
        draw_guidescope();
        selectStar(x, y);
    }
    else
    {
        show_toast_msg("WARN: you can only select a star while in idle mode");
    }
}

</script>

</head>
<body onload="onLoadAll();">
<div id="loading"><h2>OpenMV AutoGuider</h2><div class="ui-widget hideable-msg ui-state-error ui-corner-all .ui-state-error-text"><h4>Loading, Please Wait! &#9203;</h4></div></div>
<div id="loading_failed" style="display:none;" class="ui-widget"><div class="hideable-msg ui-state-error ui-corner-all .ui-state-error-text"><h1>&#128293; Loading FAILED! Please refresh the page.</h1></div></div>
<div id="loading_connecting" style="display:none;"><h2>OpenMV AutoGuider</h2><div class="ui-widget hideable-msg ui-state-error ui-corner-all .ui-state-error-text"><h4>&#9203; Connecting &#128246; guide-cam... </h4></div></div>
<div id="loading_settings" style="display:none;"><h2>OpenMV AutoGuider</h2><div class="ui-widget hideable-msg ui-state-error ui-corner-all .ui-state-error-text"><h4>&#9203; Fetching settings...</h4></div></div>
<div id="loading_almost" style="display:none;"><h2>OpenMV AutoGuider</h2><div class="ui-widget hideable-msg ui-state-error ui-corner-all .ui-state-error-text"><h4>Connected and settings loaded!<br />&#9203; Waiting for status data...</h4></div></div>
<div id="showme" style="display:none;">

<div style="width:100%"><fieldset style="padding-top: 1em;"><legend style="font-size: 14pt;">OpenMV AutoGuider Camera</legend><div id="viewme" style="display: inline-block; width:100%; padding: 0 0 0 0; margin: 0 0 0 0;"><div id="viewmesvg" style="top: 0; left: 0; display: block;">&nbsp;&nbsp;Please wait for image...</div>
</div></fieldset></div>

<div id="memory_error" class="ui-widget" style="display: none;"><div id="memory_error_inner" class="hideable-msg ui-state-error ui-corner-all .ui-state-error-text" ><p><b>&#128293; INTERNAL MEMORY ERROR!</b><br />Please check the camera exposure settings!</p></div></div>
<div id="camera_hardware_error" class="ui-widget" style="display: none;"><div id="camera_hardware_error_inner" class="hideable-msg ui-state-error ui-corner-all .ui-state-error-text" ><p><b>&#128293; CAMERA HARDWARE ERROR!</b><br />Please check the camera exposure settings.<br />Lower the shutter time.<br />Do a full power-off-power-on reset if the problem is not solved.</p></div></div>
<div id="mount_hardware_error" class="ui-widget" style="display: none;"><div id="mount_hardware_error_inner" class="hideable-msg ui-state-error ui-corner-all .ui-state-error-text" ><p><b>&#128293; MOUNT HARDWARE ERROR!</b><br />Do a full power-off-power-on reset if the problem is not solved.</p></div></div>
<div id="guide_panic_error" class="ui-widget" style="display: none;"><div id="guide_panic_error_inner" class="hideable-msg ui-state-error ui-corner-all .ui-state-error-text" ><p><b>&#128680; Guiding Panic!</b><br />Please check everything and re-start auto-guiding.</p></div></div>
<div id="camera_hardware_wait" class="ui-widget" style="display: none;"><div id="camera_hardware_wait_inner" class="hideable-msg ui-state-error ui-corner-all .ui-state-error-text" ><p>&#9203; WAITING for camera to load new exposure settings...</p></div></div>

<div id="div_errgraph"><fieldset><legend>Error Graph</legend><div id="errgraph-chart" class="ct-graph ct-major-eleventh" style="z-index:0;"><div style="text-align:right;position:relative;top:-3px;z-index:1;"><span style="font-size:8pt;" onclick="errgraph_clear();"><a href="javascript:errgraph_clear();" onclick="errgraph_clear();">click here to clear</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#FF4444"><b>&mdash;</b>&nbsp;RA&nbsp;<span>&nbsp;&nbsp;<span style="color:#4488FF">&nbsp;<b>&mdash;</b>&nbsp;DEC<span></div></fieldset></div>

<div id="connection_lost" class="ui-widget" style="display: none;"><div id="connection_lost_inner" class="hideable-msg ui-state-error ui-corner-all .ui-state-error-text" ><p><b>&#128245; Connection LOST!</b> Attempting to re-establish &#128246; &#9203;</p></div></div>

<style type="text/css">
.div_statusinfo { font-size:16pt; }
@media only screen and (max-width: 600px) {
    .div_statusinfo { font-size:14pt; }
}
@media only screen and (max-width: 500px) {
    .div_statusinfo { font-size:12pt; }
}
@media only screen and (max-width: 400px) {
    .div_statusinfo { font-size:10pt; }
}
</style>

<fieldset><legend>Status</legend>
<div class="divTable">
    <div class="divTableBody">
        <div class="divTableRow">
            <div class="divTableCell divTableCellLeft" style="padding-right: 10px">
                <div id="div_starprofile" style="display:inline;"><fieldset><legend>Star Profile</legend><div id="starprofile_div">no data</div></fieldset></div>
            </div>
            <div class="divTableCell divTableCellFill" style="width: 100%; vertical-align: top;">
                <div id="div_statusinfo" class="div_statusinfo" style="vertical-align: top;">no data</div>
            </div>
        </div>
    </div>
</div>
</fieldset>

<script type="text/javascript">
function make_ui_mainctrl()
{
    makeButton("btn_guidestart", function( event ) {
        ui_list["btn_guideend"  ].button("option", "disabled", false);
        ui_list["btn_guidestart"].button("option", "disabled", true);
        guideCmd(GUIDESTATE_GUIDING);
        guide_state_pretend = GUIDESTATE_GUIDING;
        guide_state_pretend_cnt = 0;
        if (viz_calib > 0) {
            viz_calib = 0;
            draw_guidescope();
        }
    });
    makeButton("btn_guideend", function( event ) {
        ui_list["btn_guideend"  ].button("option", "disabled", true);
        ui_list["btn_guidestart"].button("option", "disabled", false);
        guideCmd(GUIDESTATE_IDLE);
        guide_state_pretend = GUIDESTATE_IDLE;
        guide_state_pretend_cnt = 0;
    });
    makeButton("btn_gotocalibration", function( event ) {
        $("#accordion").accordion('option', 'active' , 3);
        setTimeout(scroll2calibration, 450);
    });
}

function scroll2calibration() {
    $("html, body").animate({ scrollTop: $('#scrollto_calibration').offset().top }, 500);
}
</script>

<br />
<div style="font-size:12pt; line-height:4;"><button id="btn_guidestart">Start Auto-Guiding &#127919;</button>&nbsp;&nbsp;<button id="btn_guideend">&nbsp;&nbsp;&nbsp;&nbsp;Stop&nbsp;&#9940;&nbsp;&nbsp;&nbsp;</button>&nbsp;&nbsp;<button id="btn_gotocalibration">Calibrate &#128208;</button></div>
<br />

<div id="accordion">
  <h3>Intervalometer</h3>
  <div>
    <script type="text/javascript">

var bulb_times_lut = [1, 5, 10, 15, 20, 25, 30, 45, 60, 75, 90, 105, 120, 150, 180, 210, 240, 270, (60 * 5), (60 * 6), (60 * 7), (60 * 8), (60 * 9), (60 * 10), (60 * 12), (60 * 14), (60 * 16)];

var dither_interval_lut = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17 ,18 ,19, 20, 25, 30, 35, 40, 45, 50, 60, 70, 80, 90, 100];

function make_ui_intervalometer()
{
    makeButton("btn_interval_loop", function( event ) {
        ui_list["btn_interval_stopnext"].button("option", "disabled", false);
        ui_list["btn_interval_stopnow"] .button("option", "disabled", false);
        ui_list["btn_interval_single"]  .button("option", "disabled", true);
        ui_list["btn_interval_loop"]    .button("option", "disabled", true);
        intervalometerCmd(INTERVALSTATE_ACTIVE);
    });
    makeButton("btn_interval_single", function( event ) {
        ui_list["btn_interval_stopnext"].button("option", "disabled", true);
        ui_list["btn_interval_stopnow"] .button("option", "disabled", false);
        ui_list["btn_interval_single"]  .button("option", "disabled", false);
        ui_list["btn_interval_loop"]    .button("option", "disabled", false);
        intervalometerCmd(INTERVALSTATE_BULB_TEST);
    });
    makeButton("btn_interval_stopnext", function( event ) {
        ui_list["btn_interval_stopnext"].button("option", "disabled", true);
        ui_list["btn_interval_stopnow"] .button("option", "disabled", false);
        ui_list["btn_interval_single"]  .button("option", "disabled", true);
        ui_list["btn_interval_loop"]    .button("option", "disabled", true);
        intervalometerCmd(INTERVALSTATE_ENDING);
    });
    makeButton("btn_interval_stopnow", function( event ) {
        ui_list["btn_interval_stopnext"].button("option", "disabled", true);
        ui_list["btn_interval_stopnow"] .button("option", "disabled", true);
        ui_list["btn_interval_single"]  .button("option", "disabled", false);
        ui_list["btn_interval_loop"]    .button("option", "disabled", false);
        intervalometerCmd(INTERVALSTATE_HALT);
    });
    makeSliderLookup("slider_bulbtime"            , 6, bulb_times_lut                  , "intervalometer_bulb_time");
    makeSliderLookup("slider_ditherinterval"      , 2, dither_interval_lut             , "dither_interval");
    makeSlider      ("slider_ditherlimit"         , 0, 200, 0, 1, "OFF"     , " pix"   , "dither_amount");
    makeSlider      ("slider_dithersettlethresh"  , 0, 20 , 3, 1, "0 pix"   , " pix"   , "dither_calmness");
    makeSlider      ("slider_dithersettleframecnt", 1, 20 , 3, 1, "0 frames", " frames", "dither_calm_cnt");
    makeSlider      ("slider_dithertimeout"       , 1, 20 , 5, 1, "0 frames", " frames", "dither_frames_cnt");
    makeCheckbox    ("chk_useled" , true, "use_led" );

    makeHelp("intervalometer");

    // TODO: digital intervalometer mode
}

var intervalometer_status = 0;
var intervalometer_pretend_status = -1;
var intervalometer_status_mismatch = 0;
var intervalometer_remaining = 0;
var intervalometer_timer = null;
var intervalometer_gotoidletimer = null;
function intervalometerUpdate(status, remain)
{
    intervalometer_status = status;
    if (intervalometer_remaining <= 0) {
        intervalometer_remaining = remain;
        if (remain > 0 && intervalometer_timer == null) {
            intervalometer_timer = setTimeout(intervalometerCountDown, 100);
        }
    }
    else if (remain <= 0) {
        intervalometer_remaining = 0;
    }
    else if (intervalometer_remaining > remain) {
        intervalometer_remaining = remain;
    }
    intervalometerShow();
}

function intervalometerShow()
{
    var ele = document.getElementById("bulb_status");

    var timetxt = time_formatShutterTime(intervalometer_remaining); // + " left";

    if (intervalometer_status == INTERVALSTATE_IDLE)
    {
        ele.innerHTML = "IDLE";
        ui_list["btn_interval_stopnext"].button("option", "disabled", true);
        ui_list["btn_interval_stopnow"] .button("option", "disabled", true);
        ui_list["btn_interval_single"]  .button("option", "disabled", false);
        ui_list["btn_interval_loop"]    .button("option", "disabled", false);
        if (intervalometer_gotoidletimer != null) {
            clearTimeout(intervalometer_gotoidletimer);
            intervalometer_gotoidletimer = null;
        }
    }
    else if (intervalometer_status == INTERVALSTATE_ACTIVE || intervalometer_status == INTERVALSTATE_ACTIVE_GAP)
    {
        if (guide_state != GUIDESTATE_DITHER) {
            ele.innerHTML = "Looping:<br />" + timetxt;
        }
        else {
            ele.innerHTML = "Dithering...";
        }
        ui_list["btn_interval_stopnext"].button("option", "disabled", false);
        ui_list["btn_interval_stopnow"] .button("option", "disabled", false);
        ui_list["btn_interval_single"]  .button("option", "disabled", true);
        ui_list["btn_interval_loop"]    .button("option", "disabled", true);
    }
    else if (intervalometer_status == INTERVALSTATE_BULB_TEST || intervalometer_status == INTERVALSTATE_SINGLE_ENDING)
    {
        ele.innerHTML = "Single-Shot:<br />" + timetxt;
        if (intervalometer_remaining > 0)
        {
            ui_list["btn_interval_stopnext"].button("option", "disabled", true);
            ui_list["btn_interval_stopnow"] .button("option", "disabled", false);
            ui_list["btn_interval_single"]  .button("option", "disabled", true);
            ui_list["btn_interval_loop"]    .button("option", "disabled", false);
        }
        else
        {
            ui_list["btn_interval_stopnext"].button("option", "disabled", true);
            ui_list["btn_interval_stopnow"] .button("option", "disabled", true);
            ui_list["btn_interval_single"]  .button("option", "disabled", true);
            ui_list["btn_interval_loop"]    .button("option", "disabled", false);
            if (intervalometer_gotoidletimer == null) {
                intervalometer_gotoidletimer = setTimeout(function() {
                    intervalometerUpdate(0, 0);
                }, 1000);
            }
        }
    }
    else if (intervalometer_status == INTERVALSTATE_HALT)
    {
        ele.innerHTML = "Stopping Now";
        ui_list["btn_interval_stopnext"].button("option", "disabled", true);
        ui_list["btn_interval_stopnow"] .button("option", "disabled", true);
        ui_list["btn_interval_single"]  .button("option", "disabled", true);
        ui_list["btn_interval_loop"]    .button("option", "disabled", true);
        if (intervalometer_gotoidletimer == null) {
            intervalometer_gotoidletimer = setTimeout(function() {
                intervalometerUpdate(0, 0);
            }, 1000);
        }
    }
    else if (intervalometer_status == INTERVALSTATE_ENDING)
    {
        ele.innerHTML = "Stopping On Next,<br />" + timetxt;
        ui_list["btn_interval_stopnext"].button("option", "disabled", true);
        ui_list["btn_interval_stopnow"] .button("option", "disabled", false);
        ui_list["btn_interval_single"]  .button("option", "disabled", true);
        ui_list["btn_interval_loop"]    .button("option", "disabled", false);
    }
}

function intervalometerCountDown()
{
    if (intervalometer_remaining > 100) {
        intervalometer_remaining -= 100;
    }
    else {
        intervalometer_remaining = 0;
    }
    intervalometerShow();
    intervalometer_timer = setTimeout(intervalometerCountDown, 100);
}

function intervalometerCmd(cmd)
{
    var t = settings["intervalometer_bulb_time"] * 1000;
    intervalometer_remaining = 0;
    intervalometerUpdate(cmd, t);
    intervalometer_pretend_status = cmd;
    var obj = {}
    obj["pkt_type"] = "intervalometer_cmd";
    obj["time"]     = time_getNowEpoch();
    obj["cmd"]      = cmd;
    //websock_ping_delay();
    websock_send(obj);
}
    </script>
    <p style="font-size:12pt; line-height:3.2;"><button id="btn_interval_loop">Loop&nbsp;&#128260;</button>&nbsp;<button id="btn_interval_single">Single&nbsp;&#128258;</button>&nbsp;<button id="btn_interval_stopnext">Stop On Next &#9199;</button>&nbsp;<button id="btn_interval_stopnow">Stop Now &#9940;</button></p>
    <div><fieldset><legend>Status</legend>
        <div id="bulb_status" style="font-size:20pt;">0</div>
        <div id="dither_status" style="font-size:12pt; display:none;">0</div>
    </fieldset></div>
    <div><fieldset><legend>Bulb Time: <span id="slider_bulbtime_handle"></span> sec</legend>
        <div id="slider_bulbtime"></div>
    </fieldset></div>
    <br />
    <div><fieldset><legend>Dither Dist. (0 to disable dithering): <span id="slider_ditherlimit_handle"></span></legend>
        <div id="slider_ditherlimit"></div>
    </fieldset></div>
    <div><fieldset><legend>Dither Inverval: Every <span id="slider_ditherinterval_handle">x</span> Frames</legend>
        <div id="slider_ditherinterval"></div>
    </fieldset></div>
    <div><fieldset><legend>Dither Settle Thresh: <span id="slider_dithersettlethresh_handle"></span></legend>
        <div id="slider_dithersettlethresh"></div>
    </fieldset></div>
    <div><fieldset><legend>Dither Settle Frame Count: <span id="slider_dithersettleframecnt_handle"></span></legend>
        <div id="slider_dithersettleframecnt"></div>
    </fieldset></div>
    <div><fieldset><legend>Dither Timeout Frame Count: <span id="slider_dithertimeout_handle"></span></legend>
        <div id="slider_dithertimeout"></div>
    </fieldset></div>
    <!-- TODO: digital intervalometer mode --><br />
    <div><span><label for="chk_useled">Enable LED Light?</label><input type="checkbox" name="chk_useled" id="chk_useled"></span></div>
    <br />
    <button id="helpbtn_intervalometer"></button><div id="help_intervalometer">
        <div><fieldset><legend>Help</legend><p>
            <p>This auto-guider features an intervalometer that can control the shutter of a camera. The camera must be set in <b>bulb</b> mode for this to work.</p>
            <p><b>Loop</b> operation of the intervalometer will make the camera take pictures repeatedly, each one with the exposure time as set by the "<b>Bulb Time</b>" option.</p>
            <p><b>Single</b> shot operation will take one photo at with the bulb-time exposure. Use this to get a preview photo.</p>
            <p>"<b>Stop On Next</b>" will end the loop mode of the intervalometer, so that the next photo can be previewed. Use this feature if you need to adjust camera focus (or a similar task that requires pausing and reviewing) during the session.</p>
            <p>"<b>Stop Now</b>" will immediately close the camera shutter and end the loop mode of the intervalometer. This will probably ruin the last photo being captured. Use this if you are impatient and need to change settings.</p>
        </p></fieldset></div>
        <br />
        <div><fieldset><legend>Dithering Help</legend><p>
            <p><b>Dithering</b> is a technique that reduces apparant noise in stacked photographs. If a camera is extra noisy in one spot, or has a hot-pixel, and consecutive photos from that camera are stacked together, then the noise or hot-pixel will appear in the final stacked photograph. This is because the rejection algorithms in the stacking software can reject things that sporatically appear, but not things that are always there. In layman's terms, the algorithm thinks that things that are "always there" should be there.</p>
            <p>Dithering means that for each photo, the camera is moved around slightly. This way, even though a bad pixel is staying at the same coordinate on the image, it <b>does not stay</b> at the same spot in the sky. This will make the stacking software reject the bad pixel. This also helps reduce patterned noise because it smears the noise around, while preserving signal details.</p>
            <p>Enabling dithering means that when the shutter is closed, the tracking telescope mount will be given a command to randomly move around a bit. This amount is set by the "<b>Dither Distance</b>" value. The original center position of your photo will be rembered and it won't drift more than the distance set. <b>If this value is 0, then dithering will be disabled</b>. If this value is too high, then the final stacked photo will have a smaller usable region. Also, it takes more time for the dithering operation to complete if the distance is too long.</p>
            <p>After performing each dither movement, there is extra risk of tracking errors due to gear backlash, vibration, and other factors. The firmware will wait for things to settle down before allowing the intervalometer to re-open the camera shutter. This will prevent unwanted star-trailing in the next photo after a dithering movement.</p>
            <p>The "<b>Dither Settle Thresh</b>" is the maximum amount of star motion detected so that the mount is considered "settled", if the star moves more than this amount, then the mount is not considered "settled". "<b>Dither Settle Frame Count</b>" is the number of consecutive guide-cam frames that need to be considered settled before opening the photo-cam's shutter again. "<b>Dither Timeout Frame Count</b>" is the maximum number of guide-cam frames to wait for settling, whether or not, after this timeout, the photo-cam's shutter will open.</p>
            <p>Since dithering takes time, you can choose to only dither after a certain number of frames.</p>
        </p></fieldset></div>
    </div>
    <br />
    <br />
    <div><fieldset><legend>Ideal Dither Distance</legend><p>
        <script type="text/javascript">
function dithcalc(utilize_me)
{
    var x = calc_idealDither(
          document.getElementById("num_dithcalc_gcamfocallength").value
        , document.getElementById("num_dithcalc_phcamfocallength").value
        , document.getElementById("num_dithcalc_phcamsensormm").value
        , document.getElementById("num_dithcalc_phcamsensorpix").value
        , document.getElementById("num_dithcalc_phcamdither").value
    );
    if (isNaN(x) == false)
    {
        document.getElementById("span_dithcalc_result").innerHTML = x.toFixed(1);
        if (utilize_me) {
            sliderSync("slider_ditherlimit", Math.round(x));
            $("html, body").animate({ scrollTop: $('#slider_bulbtime_handle').offset().top }, 1000);
        }
    }
    else
    {
        document.getElementById("span_dithcalc_result").innerHTML = "error";
    }
}
        </script>
        <style type="text/css">
        #tbl_dithcalc .divTableCell { border: 1px solid #999999; padding-left: 10px; padding-right: 10px; padding-bottom: 5px; }
        #tbl_dithcalc input { width: 80px; }
        #tbl_dithcalc { font-size: 10pt; }
        @media only screen and (max-width: 700px) {
            #tbl_dithcalc { font-size: 10pt; }
            #tbl_dithcalc input { width: 60px; }
        }
        @media only screen and (max-width: 550px) {
            #tbl_dithcalc { font-size: 8pt; }
            #tbl_dithcalc input { width: 60px; }
        }
        </style>
        <p>Use this calculator to determine the best dithering distance for your camera</p>
        <div id="tbl_dithcalc" class="divTable">
            <div class="divTableBody">
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;">Guide-Cam<br />Sensor Width (mm):</div>
                    <div class="divTableCell">4.8</div>
                    <div class="divTableCell">&nbsp;</div>
                </div>
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;">Guide-Cam<br />Sensor Width (pix):</div>
                    <div class="divTableCell">2592</div>
                    <div class="divTableCell">&nbsp;</div>
                </div>
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;">Guide-Scope<br />Focal Length (mm)</div>
                    <div class="divTableCell"><input type="number" id="num_dithcalc_gcamfocallength" name="num_dithcalc_gcamfocallength" min="1" max="10000" value="190" /></div>
                    <div class="divTableCell">190 mm default</div>
                </div>
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;">Photo-Cam<br />Sensor Width (mm)</div>
                    <div class="divTableCell"><input type="number" id="num_dithcalc_phcamsensormm" name="num_dithcalc_phcamsensormm" min="1" max="100" value="24" /></div>
                    <div class="divTableCell">35&nbsp;mm&nbsp;= full&#8209;frame<br />24&nbsp;mm&nbsp;= APS&#8209;C<br />17&nbsp;mm&nbsp;= MFT</div>
                </div>
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;">Photo-Cam<br />Sensor Width (pix)</div>
                    <div class="divTableCell"><input type="number" id="num_dithcalc_phcamsensorpix" name="num_dithcalc_phcamsensorpix" min="1" max="10000" value="6000" /></div>
                    <div class="divTableCell">&nbsp;</div>
                </div>
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;">Telescope<br />Focal Length (mm)</div>
                    <div class="divTableCell"><input type="number" id="num_dithcalc_phcamfocallength" name="num_dithcalc_phcamfocallength" min="1" max="10000" value="700" /></div>
                    <div class="divTableCell">&nbsp;</div>
                </div>
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;">Desired<br />Photo&#8209;Cam Dither (pix)</div>
                    <div class="divTableCell"><input type="number" id="num_dithcalc_phcamdither" name="num_dithcalc_phcamdither" min="1" max="1000" value="12" /></div>
                    <div class="divTableCell">&GreaterEqual;12 recommended</div>
                </div>
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;"><button id="btn_dithcalc" onclick="dithcalc(false);">Calculate</button>&nbsp;&nbsp;&nbsp;Result:</div>
                    <div class="divTableCell" style="text-align:right;"><span id="span_dithcalc_result">&nbsp;</span></div>
                    <div class="divTableCell"><button id="btn_dithcalc2" onclick="dithcalc(true);">Utilize Value</button></div>
                </div>
            </div>
        </div>
        <br />
    </p></fieldset></div>
  </div>
  <h3>Guide-Cam Config</h3>
  <div>
    <script type="text/javascript">

function make_ui_guidecamconfig()
{
    makeButton("btn_streamimg", function( event ) {
        disconnectAndGo("/stream", 1000);
    });
    makeButton("btn_streamimg_star", function( event ) {
        disconnectAndGo("/stream?zoom", 1000);
    });
    makeButton("btn_saveimgcard", function( event ) {
        miscCmd("snap");
    });

    makeSlider("slider_gain"              , 0  , 128 , 32  , 8  , "0 dB", " dB" , "guidecam_gain"      );
    makeSlider("slider_shutter"           , 100, 3000, 1000, 100, "0"   , " ms" , "guidecam_shutter"   );
    makeSlider("slider_starthresh"        , 0  , 255 , 0   , 1  , "auto", "/255", "guidecam_thresh"    );
    makeSlider("slider_imgerrpanicthresh" , 1  , 100 , 3   , 1  , "0"   , ""    , "panicthresh_expoerr");
    makeSlider("slider_allowedmotionwhilecapture" , 0, 100, 25, 1, "0 %", " %",    "motionwhilecapture");
    makeHelp("guidecam");
}

function imageStatsUpdate(obj)
{
    var ele = document.getElementById("div_histogram");
    var stats_str = "";
    if (obj == undefined || typeof obj == 'undefined') {
        stats_str = "no data available";
        ele.innerHTML = stats_str;
        console.log("quit");
        return;
    }
    else if (('img' in obj) == false)
    {
        stats_str = "no image data    \t";
    }
    else if (obj["img"] == false || obj["img"] == null)
    {
        stats_str = "no image captured    \t";
    }
    else
    {
        stats_str = "num of stars: " + star_list.length.toString() + "&nbsp;&nbsp;&nbsp;&nbsp;";
        stats_str += "image mean: "  + obj["img_mean"].toFixed(1)  + "/255    \t";
        stats_str += "image stdev: " + obj["img_stdev"].toFixed(1) + "/255    \t";
        stats_str += "image max: "   + Math.round(obj["img_max"]).toString() +            "/255    \t";
        stats_str += "image min: "   + Math.round(obj["img_min"]).toString() +            "/255    \t";
    }

    stats_str += "exposure code: ";

    if (('expo_code' in obj) == false)
    {
        stats_str += "missing code";
    }
    else
    {
        var exposure_code = obj["expo_code"];
        var exposure_code_txt = getExposureCode(exposure_code);
        stats_str += exposure_code_txt;

        if (exposure_code == 6) {
            document.getElementById("memory_error").style.display = "block";
        }
        else {
            document.getElementById("memory_error").style.display = "none";
        }

        if (exposure_code == 7) {
            document.getElementById("camera_hardware_error").style.display = "block";
        }
        else {
            document.getElementById("camera_hardware_error").style.display = "none";
        }

        if (exposure_code == 8) {
            document.getElementById("camera_hardware_wait").style.display = "block";
        }
        else {
            document.getElementById("camera_hardware_wait").style.display = "none";
        }
    }

    while (stats_str.includes(" ")) {
        stats_str = stats_str.replace(" ", "&nbsp;");
    }
    ele.innerHTML = stats_str;
}

    </script>
    <div>
        <div class="divTable">
            <div class="divTableBody">
                <div class="divTableRow">
                    <div class="divTableCell divTableCellLeft"><button id="btn_streamimg"      >Stream Image Full Screen</button></div>
                    <div class="divTableCell divTableCellFill">&nbsp;</div>
                    <div class="divTableCell divTableCellRight"><button id="btn_streamimg_star">Stream Image of Selected Star</button></div>
                </div>
            </div>
        </div>
    </div>
    <br />
    <div><fieldset><legend>Image Statistics</legend>
    <div id="div_histogram"></div>
    </fieldset></div>
    <br />
    <div><fieldset><legend>Camera Gain: <span id="slider_gain_handle"></span></legend>
        <div id="slider_gain"></div>
    </fieldset></div>
    <div><fieldset><legend>Shutter: <span id="slider_shutter_handle"></span></legend>
        <div id="slider_shutter"></div>
    </fieldset></div>
    <div><fieldset><legend>Star Threshold: <span id="slider_starthresh_handle"></span></legend>
        <div id="slider_starthresh"></div>
    </fieldset></div>
    <div><fieldset><legend>Image Error Panic Threshold: <span id="slider_imgerrpanicthresh_handle"></span></legend>
        <div id="slider_imgerrpanicthresh"></div>
    </fieldset></div>
    <div><fieldset><legend>Allowed Motion While Capture: <span id="slider_allowedmotionwhilecapture_handle"></span></legend>
        <div id="slider_allowedmotionwhilecapture"></div>
    </fieldset></div>
    <br />
    <button id="btn_saveimgcard"      >&#128190; Save Image to microSD Card</button>
    <br />
    <br />
    <button id="helpbtn_guidecam"></button><div id="help_guidecam">
        <div><fieldset><legend>Help</legend><p>
            <p>The "<b>Camera Gain</b>" is basically the ISO of the camera sensor. Increasing the gain will increase the overall brightness of the image, with stars easier to see. But a higher gain will mean more noise as well. Very high gain levels may cause hot-pixels to appear.</p>
            <p>The <b>shutter</b> time of the guide-cam can be adjusted. The a longer value will allow in more light, causing a brighter image and making dark stars easier to detect. But don't make the shutter time too long, because corrective movements should only be made while the guide-cam is not taking a picture, otherwise the stars will trail and cannot be analyzed.</p>
            <p>The "<b>Star Threshold</b>" is the brightness value of a pixel for it to be considered a star. If this value is left at zero, then the threshold will be automatically determined by the overall brightness of the image. A very high threshold value will cause darker stars to be ignored.</p>
            <p>The "<b>Image Error Panic Threshold</b>" is the number of frames with a bad image (some form of camera malfunction, or a search helicopter is putting a spotlight on your telescope) before the auto-guider gives up and quits guiding. The red LED light will blink to notify you.</p>
            <p>The "<b>Allowed Motion While Capture</b>" is the allowed motion that the mount is allowed to make during a guide-cam frame. If the motion is too much, then the image is considered at risk for having star-trails, and the firmware will take another frame to analyze. For example, if the setting is 25% and the shutter is set to 1000ms, then if the mount is given a 300ms pulse, then the guide-cam will take an additional frame. Set this high if the star-trailing is low, and set it low if the star-trailing is causing missed detection. Pre-emptive pulses are only generated when the guide-cam is taking the additional frame.</p>
            <p>The image from the guide-cam can be streamed. Use this stream to adjust the focus of your guide-scope. Since the file transfer speed is slow, guiding is not possible during the stream.</p>
        </p></fieldset></div>
    </div>
  </div>
  <h3>Mount Config</h3>
  <div>
    <script type="text/javascript">
function make_ui_mountconfig()
{
    makeSlider("slider_pulse_minimum"      , 10 , 500  , 50  , 1  , "0 ms", " ms", "min_pulse_wid");
    makeSlider("slider_pulse_maximum"      , 0  , 3000 , 900 , 100, "auto", " ms", "max_pulse_wid");
    makeSlider("slider_pulse_calistep_ra"  , 100, 5000 , 900 , 100, "0 ms", " ms", "calibration_pulse_ra" , "slider_pulse_calistep_ra_2" );
    makeSlider("slider_pulse_calistep_dec" , 100, 5000 , 900 , 100, "0 ms", " ms", "calibration_pulse_dec", "slider_pulse_calistep_dec_2");
    makeSlider("slider_pulse_settle"       , 0  , 500  , 50  , 1  , "0 ms", " ms", "move_grace"         );
    makeSlider("slider_dirchangehyster_ra" , 0  , 5000 , 0   , 1  , "0 ms", " ms", "backlash_hyster_ra" );
    makeSlider("slider_backlashlimit_ra"   , 0  , 10000, 0   , 100, "auto", " ms", "backlash_limit_ra"  );
    makeSlider("slider_dirchangehyster_dec", 0  , 5000 , 500 , 1  , "0 ms", " ms", "backlash_hyster_dec");
    makeSlider("slider_backlashlimit_dec"  , 0  , 10000, 5000, 100, "auto", " ms", "backlash_limit_dec" );
    makeCheckbox("chk_flip_ra" , false, "flip_ra" );
    makeCheckbox("chk_flip_dec", false, "flip_dec");
    makeHelp("mountconfig");
}
    </script>
    <div><fieldset><legend>Minimum Pulse: <span id="slider_pulse_minimum_handle"></span></legend>
        <div id="slider_pulse_minimum"></div>
    </fieldset></div>
    <div><fieldset><legend>Maximum Pulse: <span id="slider_pulse_maximum_handle"></span></legend>
        <div id="slider_pulse_maximum"></div>
    </fieldset></div>
    <div><fieldset><legend>Calibration Step Pulse (R.A.): <span id="slider_pulse_calistep_ra_handle"></span></legend>
        <div id="slider_pulse_calistep_ra"></div>
    </fieldset></div>
    <div><fieldset><legend>Calibration Step Pulse (Dec.): <span id="slider_pulse_calistep_dec_handle"></span></legend>
        <div id="slider_pulse_calistep_dec"></div>
    </fieldset></div>
    <div><fieldset><legend>Settle Time: <span id="slider_pulse_settle_handle"></span></legend>
        <div id="slider_pulse_settle"></div>
    </fieldset></div>
    <div><fieldset><legend>Direction Change Hysteresis (R.A.): <span id="slider_dirchangehyster_ra_handle"></span></legend>
        <div id="slider_dirchangehyster_ra"></div>
    </fieldset></div>
    <div><fieldset><legend>Direction Bias Limiter (R.A.): <span id="slider_backlashlimit_ra_handle"></span></legend>
        <div id="slider_backlashlimit_ra"></div>
    </fieldset></div>
    <div><fieldset><legend>Direction Change Hysteresis (Dec.): <span id="slider_dirchangehyster_dec_handle"></span></legend>
        <div id="slider_dirchangehyster_dec"></div>
    </fieldset></div>
    <div><fieldset><legend>Direction Bias Limiter (Dec.): <span id="slider_backlashlimit_dec_handle"></span></legend>
        <div id="slider_backlashlimit_dec"></div>
    </fieldset></div>
    <br />
    <div><span><label for="chk_flip_ra">Flip RA?</label><input type="checkbox" name="chk_flip_ra" id="chk_flip_ra"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span><label for="chk_flip_dec">Flip DEC?</label><input type="checkbox" name="chk_flip_dec" id="chk_flip_dec"></span></div>
    <br />
    <button id="helpbtn_mountconfig"></button><div id="help_mountconfig">
        <div><fieldset><legend>Help</legend><p>
            <p>This auto-guider camera uses ST-4 signals to control an electronic telescope mount. When the signal is "ON", the motors inside the mount will spin faster. How long a signal is ON for, the length of the <b>pulse</b>, determines how much the mount moves. If the pulse is too short, the electronics might not detect it. If the pulse is too long, then the motion analysis need to happen much later, so the responsiveness is worse.</p>
            <p>The pulses used for each calibration step can be much longer, and a longer pulse can mean a more accurate calibration.</p>
            <p>"<b>Settle Time</b>" is the time that the signal is OFF for after each ON pulse. This can be very short, or even zero.</p>
            <p>Tracking errors of an electronic mount usually are biased in one direction. These mounts also have some backlash in their gears. This means that changing the direction of consecutive corrective movements is a bad idea as it can become ineffective, or over-correct. The corrective-movement-calculation firmware will track the direction bias, and if it detects a bias, it will lock-in a direction, preventing movements in the other direction. The "<b>Direction Change Hysteresis</b>" value represents how easy it is to detect the bias, and also how easy it is to change that bias.</p>
            <p>For example, the hysteresis value is 100 ms, a star moved and required a 100 ms movement to the right, the firmware will remember that the bias is towards the right. Then, if the star moved and required a 50 ms move to the left, the command to move will not actually be given, because the bias is towards the right, and all left-ward commands will be ignored. But if the star moved and required 200 ms move to the left, then it will actually perform the 200 ms move to the left, because with 200 ms, it has crossed the direction change hysteresis value.</p>
            <p>This technique helps the most with "momentary movements that naturally returns to original position", such as movement caused by wind. These types of moments shouldn't require correction, as the risk of (and penalty for) over-correction is high. It is similar to the "<b>ResistSwitch</b>" algorithm present in PHD2.</p>
            <p>This feature is most useful for the declination axis because it shouldn't need to actually spin unless there's a bad polar-alignment, and in that case, the declination motor should only spin in one direction, never the other direction.</p>
            <p>Many astrophotographers prefer to be very slightly off in polar-alignment so that guide corrections are always in the same direction. Keeps the declination motor always spinning in the same direction, and thus this guarantees that the gears will be always meshed together.</p>
            <p>For the R.A. axis, the axis is always spinning and the small imperfections of the gears. Locking in the direction of correction would make sense for small imperfections of the gears, but not larger ones.</p>
            <p>"<b>Direction Bias Limiter</b>" is an internal maximum limit value for the accumulated value that determines the direction bias. Leave it at zero for it to be automatic. A large value will cause direction bias to never switch directions! The appropriate hysteresis value and limit value are different for every tracking telescope mount. More backlash requires higher values.</p>
        </p></fieldset></div>
    </div>
  </div>
  <h3 id="scrollto_calibration">Calibration</h3>
  <div>
    <script type="text/javascript">
function make_ui_calibration()
{
    makeSlider("slider_pulse_calistep_ra_2" , 100, 5000, 900, 100, "0 ms", " ms", "calibration_pulse_ra" , "slider_pulse_calistep_ra");
    makeSlider("slider_pulse_calistep_dec_2", 100, 5000, 900, 100, "0 ms", " ms", "calibration_pulse_dec", "slider_pulse_calistep_dec");
    makeSlider("slider_calistepcnt"         , 5  , 50  , 10 , 1  , "0"   , ""   , "calib_points_cnt"    );
    makeSlider("slider_correctionscale_ra"  , 75 , 133 , 100, 1  , "0 %" , " %" , "correction_scale_ra" );
    makeSlider("slider_correctionscale_dec" , 75 , 133 , 100, 1  , "0 %" , " %" , "correction_scale_dec");
    makeButton("btn_calib_ra", function() {
        guideCmd(GUIDESTATE_CALIBRATING_RA);
        ignore_next = true;
        document.getElementById("calibinfo_ra").innerHTML = "Running Calibration...";
    });
    makeButton("btn_calib_dec", function() {
        guideCmd(GUIDESTATE_CALIBRATING_DEC);
        ignore_next = true;
        document.getElementById("calibinfo_dec").innerHTML = "Running Calibration...";
    });
    makeButton("btn_calib_save", function() {
        miscCmd("calib_save");
    });
    makeButton("btn_calib_load", function() {
        miscCmd("calib_load");
        ignore_next = true;
        document.getElementById("calibinfo_ra") .innerHTML = "Loading...";
        document.getElementById("calibinfo_dec").innerHTML = "Loading...";
    });
    makeButton("btn_calib_remove_ra", function() {
        miscCmd("calib_reset_ra");
        ignore_next = true;
        document.getElementById("calibinfo_ra").innerHTML = "None";
    });
    makeButton("btn_calib_remove_dec", function() {
        miscCmd("calib_reset_dec");
        ignore_next = true;
        document.getElementById("calibinfo_dec").innerHTML = "None";
    });
    makeCheckbox("chk_visualize_cali", false, function (x) {
        viz_calib = x ? 3 : 0;
        draw_guidescope();
        if (x) {
            $("html, body").animate({ scrollTop: $('html, body').offset().top }, 1000);
        }
    });
    makeHelp("calibration");

    makeButton("btn_testpulse_n", function () {
        disable_testpulsebtns();
        miscCmd("testpulse_n");
        enable_testpulsebtns_later();
    });
    makeButton("btn_testpulse_s", function () {
        disable_testpulsebtns();
        miscCmd("testpulse_s");
        enable_testpulsebtns_later();
    });
    makeButton("btn_testpulse_e", function () {
        disable_testpulsebtns();
        miscCmd("testpulse_e");
        enable_testpulsebtns_later();
    });
    makeButton("btn_testpulse_w", function () {
        disable_testpulsebtns();
        miscCmd("testpulse_w");
        enable_testpulsebtns_later();
    });
}

function disable_testpulsebtns()
{
    ui_list["btn_testpulse_n"].button("option", "disabled", true);
    ui_list["btn_testpulse_s"].button("option", "disabled", true);
    ui_list["btn_testpulse_e"].button("option", "disabled", true);
    ui_list["btn_testpulse_w"].button("option", "disabled", true);
}

function enable_testpulsebtns()
{
    ui_list["btn_testpulse_n"].button("option", "disabled", false);
    ui_list["btn_testpulse_s"].button("option", "disabled", false);
    ui_list["btn_testpulse_e"].button("option", "disabled", false);
    ui_list["btn_testpulse_w"].button("option", "disabled", false);
}

function enable_testpulsebtns_later()
{
    setTimeout(enable_testpulsebtns, 1000);
}
    </script>
    <p>Calibration is required before auto-guiding. It correlates how much a star mas moved in the guide-cam image, to how long of a movement command pulse needs to be. It also determines the angular orientation of the guide-camera.</p>

    <div><fieldset><legend>R.A. Calibration</legend>
        <div><button id="btn_calib_ra">&#128208; Run Calibration</button>&nbsp;&nbsp;<button id="btn_calib_remove_ra">Remove &#10060;</button></div>
        <br />
        <div id="calibinfo_ra">None</div>
    </fieldset></div>
    <div><fieldset><legend>Dec. Calibration</legend>
        <div><button id="btn_calib_dec">&#128208; Run Calibration</button>&nbsp;&nbsp;<button id="btn_calib_remove_dec">Remove &#10060;</button></div>
        <br />
        <div id="calibinfo_dec">None</div>
    </fieldset></div>
    <br />

    <div style="line-spacing: 4;"><button id="btn_calib_save">&#128190; Save File</button>&nbsp;&nbsp;&nbsp;&nbsp;<button id="btn_calib_load">&#128209; Load File</button></div>
    <br />
    <label for="chk_visualize_cali">Visualize?</label><input type="checkbox" name="chk_visualize_cali" id="chk_visualize_cali" />
    <br /><br />

    <div><fieldset><legend>Calibration Step Pulse (R.A.): <span id="slider_pulse_calistep_ra_2_handle"></span></legend>
        <div id="slider_pulse_calistep_ra_2"></div>
    </fieldset></div>
    <div><fieldset><legend>Calibration Step Pulse (Dec.): <span id="slider_pulse_calistep_dec_2_handle"></span></legend>
        <div id="slider_pulse_calistep_dec_2"></div>
    </fieldset></div>
    <div><fieldset><legend>Calibration Step Count: <span id="slider_calistepcnt_handle"></span></legend>
        <div id="slider_calistepcnt"></div>
    </fieldset></div>
    <div><fieldset><legend>Correction Scale R.A.&nbsp;&nbsp;: <span id="slider_correctionscale_ra_handle"></span></legend>
        <div id="slider_correctionscale_ra"></div>
    </fieldset></div>
        <div><fieldset><legend>Correction Scale Dec.&nbsp;&nbsp;: <span id="slider_correctionscale_dec_handle"></span></legend>
        <div id="slider_correctionscale_dec"></div>
    </fieldset></div>

    <br />
    <div><fieldset><legend>Issue Single Pulse</legend><div>
        <div class="divTable" style="width:inherit;">
        <div class="divTableBody">
        <div class="divTableRow">
        <div class="divTableCell">&nbsp;</div>
        <div class="divTableCell"><button id="btn_testpulse_n">N</button></div>
        <div class="divTableCell">&nbsp;</div>
        </div>
        <div class="divTableRow">
        <div class="divTableCell"><button id="btn_testpulse_w">W</button></div>
        <div class="divTableCell">&nbsp;</div>
        <div class="divTableCell"><button id="btn_testpulse_e">E</button></div>
        </div>
        <div class="divTableRow">
        <div class="divTableCell">&nbsp;</div>
        <div class="divTableCell"><button id="btn_testpulse_s">S</button></div>
        <div class="divTableCell">&nbsp;</div>
        </div>
        </div>
        </div>
    </div></fieldset></div>

    <br />
    <button id="helpbtn_calibration"></button><div id="help_calibration">
        <div><fieldset><legend>Help</legend><p>
            <p>During calibration, a star will be tracked and movement command pulses will be given to the tracking telescope mount. If the pulse given is 1000 ms long, and the star moved 10 pixels in the guide-cam image, then the scaling is remembered as 100 ms-per-pixel, or as 0.01 pixels-per-ms. The direction of the movement is also remembed.</p>
            <p>This is done many times (number of steps) to get an accurate average value. It is also done in both the <b>R</b>ight-<b>A</b>scension axis and <b>Dec</b>lination axis independantly.</p>
            <p>If you are using a R.A.-only type of tracking mount, such as the Star Adventurer or Sky Guider, then only the R.A. calibration is required. If you are using a computerized go-to type of telescope mount, then both R.A. and declination calibration are required.</p>
            <p>Calibration needs to be done any time your camera is pointed in a different direction! This usually means once per night!</p>
            <p>Calibration can be saved, with a timestamp, so they can be reloaded. This is useful in the event of a brief power failure.</p>
            <p>The "<b>Correction Scale</b>" value will scale the ms-per-pixel that is actually used to make corrective movements. Lower this value below 100% to combat cronic over-correction.</p>
            <p>NOTE: This auto-guider firmware does not care about things such as focal length of the lens or the speed of the tracking mount motors when given a pulse. Everything is simply based on the number of pixels that a star moves on the guide-cam, and the duration of the pulses. The units cannot be correlated directly to angular units (aka degrees).</p>
        </p>
        </fieldset></div>
    </div>
    <br />
    <br />
    <div><fieldset><legend>Ideal Calibration Pulse Calculator</legend><p>
        <script type="text/javascript">
function calc_calpulse(utilize)
{
    var x = calc_idealCalibPulse(
          document.getElementById("sel_calpulse_guiderate").value
        , document.getElementById("num_calpulse_gcamfocallength").value
        //, document.getElementById("num_calpulse_numsteps").value
        , settings["calib_points_cnt"]
        , 25
        , document.getElementById("num_calpulse_declination").value
    );
    if (isNaN(x[0]) == false && isNaN(x[1]) == false)
    {
        document.getElementById("span_calpulse_result").innerHTML = "Dec.=" + Math.round(x[0]) + "&nbsp;ms&nbsp;;&nbsp;R.A.=" + Math.round(x[1]) + "&nbsp;ms";
        if (utilize) {
            sliderSync("slider_pulse_calistep_dec"  , Math.round(x[0]));
            sliderSync("slider_pulse_calistep_dec_2", Math.round(x[0]));
            sliderSync("slider_pulse_calistep_ra"   , Math.round(x[1]));
            sliderSync("slider_pulse_calistep_ra_2" , Math.round(x[1]));
            $("html, body").animate({ scrollTop: $('#chk_visualize_cali').offset().top }, 1000);
        }
    }
    else
    {
        document.getElementById("span_calpulse_result").innerHTML = "error";
    }
}

function calc_pixpulse()
{
    var x = calc_pixelsPulse(
          document.getElementById("sel_calpulse_guiderate").value
        , document.getElementById("num_calpulse_gcamfocallength").value
        , 1
        );
    if (isNaN(x) == false)
    {
        document.getElementById("span_pixpulse_result").innerHTML = Math.round(x) + "&nbsp;ms";
    }
    else
    {
        document.getElementById("span_calpulse_result").innerHTML = "error";
    }
}
        </script>
        <style type="text/css">
        #tbl_calpulsecalc .divTableCell { border: 1px solid #999999; padding-left: 10px; padding-right: 10px; padding-bottom: 5px; }
        #tbl_calpulsecalc input { width: 100px; }
        #tbl_calpulsecalc { font-size: 10pt; }
        @media only screen and (max-width: 700px) {
            #tbl_calpulsecalc { font-size: 10pt; }
            #tbl_calpulsecalc input { width: 60px; }
        }
        @media only screen and (max-width: 550px) {
            #tbl_calpulsecalc { font-size: 8pt; }
            #tbl_calpulsecalc input { width: 60px; }
        }
        </style>

        <p>Calibration is ideal when the calibration points span a large region of the screen. The pulse required to achieve the spacing of those points depends on how fast the tracking mount rotates when given that pulse. The setting for the R.A. axis depends on where in the sky you are pointing at. Use the calculator below to calculate the ideal pulse width for use during calibration, based on the specification of the tracking mount and where you are pointing.</p>
        <div id="tbl_calpulsecalc" class="divTable">
            <div class="divTableBody">
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;">Guiding Rate</div>
                    <div class="divTableCell">
                        <select name="sel_calpulse_guiderate" id="sel_calpulse_guiderate">
                            <option value="0.1">0.1x</option>
                            <option value="0.125">0.125x</option>
                            <option value="0.25">0.25x</option>
                            <option value="0.5" selected="selected">0.5x</option>
                            <option value="0.75">0.75x</option>
                            <option value="1">1x</option>
                            <option value="1.25">1.25x</option>
                            <option value="1.5">1.5x</option>
                            <option value="1.75">1.75x</option>
                            <option value="2">2x</option>
                        </select>&nbsp;sidereal
                    </div>
                    <div class="divTableCell">please&nbsp;use 0.5x</div>
                </div>
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;">Guide&#8209;Scope<br />Focal&nbsp;Length (mm)</div>
                    <div class="divTableCell"><input type="number" id="num_calpulse_gcamfocallength" name="num_calpulse_gcamfocallength" min="1" max="10000" value="190" /></div>
                    <div class="divTableCell">190&nbsp;mm default</div>
                </div>
                <!--
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;">Num. of Steps</div>
                    <div class="divTableCell"><input type="number" id="num_calpulse_numsteps" name="num_calpulse_numsteps" min="1" max="50" value="10" /></div>
                    <div class="divTableCell">&nbsp;</div>
                </div>
                -->
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;">Pointing Declination&nbsp;(deg)</div>
                    <div class="divTableCell"><input type="number" id="num_calpulse_declination" name="num_calpulse_declination" min="0" max="90" value="45" /></div>
                    <div class="divTableCell">&nbsp;</div>
                </div>
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;"><button id="btn_calpulse" onclick="calc_calpulse(false);">Calculate</button>&nbsp;&nbsp;&nbsp;Result:</div>
                    <div class="divTableCell" style="text-align:right;"><span id="span_calpulse_result">&nbsp;</span></div>
                    <div class="divTableCell"><button id="btn_calpulse2" onclick="calc_calpulse(true);">Utilize Value</button></div>
                </div>
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;"><button id="btn_pixpulse" onclick="calc_pixpulse();">Calc for 1 pixel</button></div>
                    <div class="divTableCell" style="text-align:right;"><span id="span_pixpulse_result">&nbsp;</span></div>
                    <div class="divTableCell">&nbsp;</div>
                </div>
            </div>
        </div>
    </p>
    </fieldset></div>
  </div>
  <h3>Analysis Parameters</h3>
  <div>
    <script type="text/javascript">
function make_ui_analysisparameters()
{
    makeSlider("slider_multistar", 1, 100, 1, 1, "0", "", "multistar_cnt_max");
    makeSlider("slider_motionerrortolerance", 1, 200, 50, 1, "0 pix", " pix", "starmove_tolerance");
    makeSlider("slider_motionerrorpanicthresh", 0, 500, 50, 1, "0 pix", " pix", "panicthresh_move_err");
    makeSlider("slider_correctlymovedstarsrequired", 0, 100, 50, 1, "0 %", " %", "starmove_correctrequired");
    makeSlider("slider_motionerrorcountpanicthresh", 1, 100, 2, 1, "0", "", "panicthresh_move_cnt");
    makeSlider("slider_multistarratingthresh", 0, 100, 50, 1, "0 %", " %", "multistar_ratings_thresh");
    makeSlider("slider_clustertolerance", 0, 500, 100, 1, "0 pix", " pix", "clustering_tolerance");
    makeHelp("analysisparams");
}
    </script>
    <p>These parameters are used to fine tune the star motion analysis software.</p>
    <div><fieldset><legend>Stars Used: <span id="slider_multistar_handle"></span></legend>
        <div id="slider_multistar"></div>
    </fieldset></div>
    <div><fieldset><legend>Motion Error Tolerance: <span id="slider_motionerrortolerance_handle"></span></legend>
        <div id="slider_motionerrortolerance"></div>
    </fieldset></div>
    <div><fieldset><legend>Motion Error Amount Thresh: <span id="slider_motionerrorpanicthresh_handle"></span></legend>
        <div id="slider_motionerrorpanicthresh"></div>
    </fieldset></div>
    <div><fieldset><legend>Correctly Moved Stars Required: <span id="slider_correctlymovedstarsrequired_handle"></span></legend>
        <div id="slider_correctlymovedstarsrequired"></div>
    </fieldset></div>
    <div><fieldset><legend>Bad Frame Count Thresh: <span id="slider_motionerrorcountpanicthresh_handle"></span></legend>
        <div id="slider_motionerrorcountpanicthresh"></div>
    </fieldset></div>
    <div><fieldset><legend>Multi-Star Rating Thresh: <span id="slider_multistarratingthresh_handle"></span></legend>
        <div id="slider_multistarratingthresh"></div>
    </fieldset></div>
    <div><fieldset><legend>Cluster Tolerance: <span id="slider_clustertolerance_handle"></span></legend>
        <div id="slider_clustertolerance"></div>
    </fieldset></div>
    <br />
    <button id="helpbtn_analysisparams"></button><div id="help_analysisparams">
        <div><fieldset><legend>Help</legend><p>
            <p>The number of stars used for motion analysis can be 1 or more. Usage of multiple stars is advised to combat the effects of turbulent air in the atmosphere (aka <i>atmospheric seeing</i> or <i>astronomical seeing</i>). The motion of multiple stars can be averaged together, instead of analyzing just one star, in order to prevent detection of motion that didn't really occur.</p>
            <p>When multiple stars are used for motion analysis, the best stars, ranked by its "<i>rating</i>", are used. The "<b>Multi-Star Rating Thresh</b>" is the minimum rating a star needs to have for it to be used in the analysis. A good rating means the star can be accurately confidently tracked and is not too close to the edge of the guide-cam frame.</p>
            <p>"<b>Motion Error</b>" is measured in pixels. If all of the stars moved 5 pixels to the left, then the motion error is considered 0. If one star moved 5 pixels left but another star moved 5 pixels right, then the motion error is considered to be 10 pixels. A high amount of motion analysis error is unlikely in most scenarios but you can set thresholds for the error to cause panic mode.</p>
            <p>"<b>Motion Error Tolerance</b>" is the amount of motion error tolerated by the analysis code, it will simply not analyze stars that moved more than this amount in the wrong direction.</p>
            <p>"<b>Motion Error Amount Thresh</b>" is the average amount of motion error in the motion analysis that will trigger one frame to be considered a panic-inducing frame.</p>
            <p>"<b>Correctly Moved Stars Required</b>" is the number of stars (as a percentage of the total number of stars) that appears to have moved in the correct way. If too many stars moved the wrong way, it counts as a bad analysis and counts as a panic-inducing frame.</p>
            <p>"<b>Panic Count Thresh</b>" is the number of consecutive panic-inducing frames that needs to happen before the hardware actually gives up and starts to blink the red LED light. This setting can be 1, or it can be more, so that maybe a single bat flying over your camera doesn't cause the hardware to throw in the towel. Long periods of cloudy sky, or knocking over the telescope, will cause many panic-inducing frames and you will see the blinking red LED light.</p>
            <p>When too many stars are very close together, it might confuse the motion analysis software. "<b>Cluster Tolerance</b>" determines how far apart a star need to be away from its nearest neighbouring star for it to be used for motion analysis.</p>
        </p></fieldset></div>
    </div>
  </div>
  <h3>Advanced Filtering</h3>
  <div>
<script>
const advfilter_table = [
    ["advfilt_xxx_term_i" , "num_advfilt_xxx_iterm"],
    ["advfilt_xxx_term_d" , "num_advfilt_xxx_dterm"],
    ["advfilt_xxx_decay_i", "num_advfilt_xxx_idecay"],
    ["advfilt_xxx_limit_i", "num_advfilt_xxx_ilimit"],
    ["advfilt_xxx_lpf_k"  , "num_advfilt_xxx_lpfconst"],
    ["advfilt_xxx_lpf_mix", "num_advfilt_xxx_lpfmix"],
    ["preempfilt_xxx_term_i" , "num_preempfilt_xxx_iterm"],
    ["preempfilt_xxx_term_d" , "num_preempfilt_xxx_dterm"],
    ["preempfilt_xxx_decay_i", "num_preempfilt_xxx_idecay"],
    ["preempfilt_xxx_limit_i", "num_preempfilt_xxx_ilimit"],
    ["preempfilt_xxx_lpf_k"  , "num_preempfilt_xxx_lpfconst"],
    ["preempfilt_xxx_lpf_mix", "num_preempfilt_xxx_lpfmix"],
    ["preempfilt_xxx_scale"  , "num_preempfilt_xxx_scale"],
];

function get_num_input(id) {
    var ele = document.getElementById(id);
    return parseInt(ele.value);
}

function queueAllAdvFilt()
{
    var i;
    for (i = 0; i < advfilter_table.length; i++)
    {
        var pair = advfilter_table[i];
        var setting_key_ra  = pair[0].replace("xxx", "ra");
        var input_key_ra    = pair[1].replace("xxx", "ra");
        var setting_key_dec = pair[0].replace("xxx", "dec");
        var input_key_dec   = pair[1].replace("xxx", "dec");
        queueSettingsUpdate(setting_key_ra,  get_num_input(input_key_ra ));
        queueSettingsUpdate(setting_key_dec, get_num_input(input_key_dec));
    }
}

function make_ui_advflt()
{
    resetAdvFilterSettings();
    makeButton("btn_advfilt_update", function() {
        queueAllAdvFilt();
    });
    makeButton("btn_advfilt_undo", function() {
        fillAdvFilterSettings(settings);
    });
    makeButton("btn_advfilt_reset", function() {
        resetAdvFilterSettings();
        queueAllAdvFilt();
    });
    makeHelp("advfilt");
}

function fillAdvFilterSettings(obj)
{
    if (obj === undefined || typeof obj === 'undefined')
    {
        if (settings !== undefined && typeof settings !== 'undefined') {
            obj = settings;
        }
        else {
            return;
        }
    }

    if (obj == null)
    {
        if (settings !== undefined && typeof settings !== 'undefined') {
            obj = settings;
        }
        else {
            return;
        }
    }

    var i;
    for (i = 0; i < advfilter_table.length; i++)
    {
        var pair = advfilter_table[i];
        var setting_key_ra  = pair[0].replace("xxx", "ra");
        var input_key_ra    = pair[1].replace("xxx", "ra");
        var setting_key_dec = pair[0].replace("xxx", "dec");
        var input_key_dec   = pair[1].replace("xxx", "dec");
        if ((setting_key_ra in obj)) {
            document.getElementById(input_key_ra) .value = obj[setting_key_ra];
        }
        if ((setting_key_dec in obj)) {
            document.getElementById(input_key_dec).value = obj[setting_key_dec];
        }
    }
}

function resetAdvFilterSettings()
{
    var i;
    for (i = 0; i < advfilter_table.length; i++)
    {
        var pair = advfilter_table[i];
        var input_key_ra    = pair[1].replace("xxx", "ra");
        var input_key_dec   = pair[1].replace("xxx", "dec");
        if (input_key_ra.includes("scale"))
        {
            if (input_key_ra.includes("preemp"))
            {
                document.getElementById(input_key_ra) .value = 25;
                document.getElementById(input_key_dec).value = 25;
            }
            else
            {
                document.getElementById(input_key_ra) .value = 100;
                document.getElementById(input_key_dec).value = 100;
            }
        }
        else
        {
            document.getElementById(input_key_ra) .value = 0;
            document.getElementById(input_key_dec).value = 0;
        }
    }
}
</script>
    <div>
        <p>The auto-guider can employ a P.I.D. controller and a L.P.F. to the guidance pulses.</p>
        <button id="helpbtn_advfilt"></button>
        <div id="help_advfilt"><fieldset><legend>Help</legend>
        <p>The sources of tracking errors can be totally random (such as gear imperfections), or have a directional bias (such as bad polar-alignment). The latter is more frequent and more important, because random errors are self-correcting in nature. To fine tune the performance of the error correction, the auto-guider can employ a P.I.D. controller and a L.P.F. (<b>L</b>ow-<b>P</b>ass <b>F</b>ilter). The L.P.F. filter simply follows the equation:<br />&nbsp;&nbsp;&nbsp;&nbsp;<pre><i>next = input * k + (prev * (1 - k))</i></pre><br /> These filter can be used to prevent over-correction due to sporatic random errors, and cronic under-correction of heavily biased errors.</p>
        <p>The P-term of the PID is always unity, as it is actually determined by the calibration and the calibration scaling. The Integral term and Derivative term can be set as a percentage (100 means 1, 0 means disable). The accumulator for the integral term has a limiter and a decay value to prevent it from getting stuck. Setting the I-term and D-term to 0 would disable this PID.</p>
        <p>The LPF filter constant is expressed also as a percentage, a filter constant of 100% would cause the filter to be a unity pass-through, a filter constant of 0% would disable the LPF.</p>
        <p>The mixture between the PID and the LPF can be mixed, the mixture value is a percentage between 0% and 100%. 0% would mean the LPF is disabled, and the result from the PID is used. 100% means the PID is disabled, and the result from the LPF is used. Any value in between would mix the results from the PID and the LPF together.</p>
        <p>There's also a separate P.I.D. controller and L.P.F. that's used for a pre-emptive move, that is, a <b>move made before a guide-cam image is analyzed</b>. The parameters are similar, but with an additional scaling factor applied to the end. This pre-emptive move is not made if the guide-cam image analysis does not skip frames.</p>
        </fieldset><br /></div>
    </div>
    <div style="font-family:monospace;">
        <style type="text/css">
.advfilt_num { width:100px; }
@media only screen and (max-width: 600px) {
    .advfilt_num { width:80px; }
    .advfilt_tbl { font-size:10pt; }
}
@media only screen and (max-width: 460px) {
    .advfilt_num { width:60px; }
    .advfilt_tbl { font-size:8pt; }
}
        </style>
        <div><fieldset><legend>Corrective Controller</legend>
        <div class="divTable advfilt_tbl" style="width:80%;">
            <div class="divTableBody">
                <div class="divTableRow">
                    <div class="divTableCell">&nbsp;</div>
                    <div class="divTableCell">&nbsp;&nbsp;R.A.</div>
                    <div class="divTableCell">&nbsp;&nbsp;Dec.</div>
                </div>
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;">I&#8209;term&nbsp;&nbsp;</div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_advfilt_ra_iterm" name="num_advfilt_ra_iterm" min="-99999" max="99999" step="1" /></div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_advfilt_dec_iterm" name="num_advfilt_dec_iterm" min="-99999" max="99999" step="1" />&nbsp;%</div>
                </div>
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;">I&nbsp;limiter&nbsp;&nbsp;</div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_advfilt_ra_ilimit" name="num_advfilt_ra_ilimit" min="0" max="9999999" step="1" /></div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_advfilt_dec_ilimit" name="num_advfilt_dec_ilimit" min="0" max="9999999" step="1" />&nbsp;ms</div>
                </div>
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;">I&nbsp;decay&nbsp;&nbsp;</div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_advfilt_ra_idecay" name="num_advfilt_ra_idecay" min="0" max="9999999" step="1" /></div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_advfilt_dec_idecay" name="num_advfilt_dec_idecay" min="0" max="9999999" step="1" />&nbsp;ms</div>
                </div>
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;">D&#8209;term&nbsp;&nbsp;</div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_advfilt_ra_dterm" name="num_advfilt_ra_dterm" min="-99999" max="99999" step="1" /></div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_advfilt_dec_dterm" name="num_advfilt_dec_dterm" min="-99999" max="99999" step="1" />&nbsp;%</div>
                </div>
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;">LPF const&nbsp;&nbsp;</div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_advfilt_ra_lpfconst" name="num_advfilt_ra_lpfconst" min="0" max="100" step="1" /></div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_advfilt_dec_lpfconst" name="num_advfilt_dec_lpfconst" min="0" max="100" step="1" />&nbsp;%</div>
                </div>
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;">LPF mix&nbsp;&nbsp;</div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_advfilt_ra_lpfmix" name="num_advfilt_ra_lpfmix" min="0" max="100" step="1" /></div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_advfilt_dec_lpfmix" name="num_advfilt_dec_lpfmix" min="0" max="100" step="1" />&nbsp;%</div>
                </div>
            </div>
        </div>
      </fieldset></div>

      <div><fieldset><legend>Pre-emptive Controller</legend>
        <div class="divTable advfilt_tbl" style="width:80%;">
            <div class="divTableBody">
                <div class="divTableRow">
                    <div class="divTableCell">&nbsp;</div>
                    <div class="divTableCell">&nbsp;&nbsp;R.A.</div>
                    <div class="divTableCell">&nbsp;&nbsp;Dec.</div>
                </div>
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;">I&#8209;term&nbsp;&nbsp;</div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_preempfilt_ra_iterm" name="num_preempfilt_ra_iterm" min="-99999" max="99999" step="1" /></div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_preempfilt_dec_iterm" name="num_preempfilt_dec_iterm" min="-99999" max="99999" step="1" />&nbsp;%</div>
                </div>
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;">I&nbsp;limiter&nbsp;&nbsp;</div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_preempfilt_ra_ilimit" name="num_preempfilt_ra_ilimit" min="0" max="9999999" step="1" /></div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_preempfilt_dec_ilimit" name="num_preempfilt_dec_ilimit" min="0" max="9999999" step="1" />&nbsp;ms</div>
                </div>
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;">I&nbsp;decay&nbsp;&nbsp;</div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_preempfilt_ra_idecay" name="num_preempfilt_ra_idecay" min="0" max="9999999" step="1" /></div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_preempfilt_dec_idecay" name="num_preempfilt_dec_idecay" min="0" max="9999999" step="1" />&nbsp;ms</div>
                </div>
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;">D&#8209;term&nbsp;&nbsp;</div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_preempfilt_ra_dterm" name="num_preempfilt_ra_dterm" min="-99999" max="99999" step="1" /></div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_preempfilt_dec_dterm" name="num_preempfilt_dec_dterm" min="-99999" max="99999" step="1" />&nbsp;%</div>
                </div>
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;">LPF const&nbsp;&nbsp;</div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_preempfilt_ra_lpfconst" name="num_preempfilt_ra_lpfconst" min="0" max="100" step="1" /></div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_preempfilt_dec_lpfconst" name="num_preempfilt_dec_lpfconst" min="0" max="100" step="1" />&nbsp;%</div>
                </div>
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;">LPF mix&nbsp;&nbsp;</div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_preempfilt_ra_lpfmix" name="num_preempfilt_ra_lpfmix" min="0" max="100" step="1" /></div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_preempfilt_dec_lpfmix" name="num_preempfilt_dec_lpfmix" min="0" max="100" step="1" />&nbsp;%</div>
                </div>
                <div class="divTableRow">
                    <div class="divTableCell" style="text-align:right;">Scale&nbsp;&nbsp;</div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_preempfilt_ra_scale" name="num_preempfilt_ra_scale" min="0" max="200" step="1" /></div>
                    <div class="divTableCell"><input class="advfilt_num" type="number" id="num_preempfilt_dec_scale" name="num_preempfilt_dec_scale" min="0" max="200" step="1" />&nbsp;%</div>
                </div>
            </div>
        </div>
      </fieldset></div>

    <br />
    <div class="divTable" style="width:80%;">
        <div class="divTableBody">
            <div class="divTableRow">
                <div class="divTableCell"><button id="btn_advfilt_update">Update Values</button></div>
                <div class="divTableCell divTableCellFill">&nbsp;</div>
                <div class="divTableCell"><button id="btn_advfilt_undo">Undo Changes</button></div>
                <div class="divTableCell divTableCellFill">&nbsp;</div>
                <div class="divTableCell"><button id="btn_advfilt_reset">Reset Values</button></div>
            </div>
        </div>
      </div>

    </div>
  </div>
  <h3>Hot Pixels</h3>
  <div>
    <script type="text/javascript">
function make_ui_hotpixels()
{
    makeButton("btn_hotpixels", function() {
        miscCmd("hotpixels_save");
        ui_list["btn_hotpixels"]      .button("option", "disabled", true);
    });
    makeButton("btn_forgethotpixels", function() {
        miscCmd("hotpixels_disable");
        ui_list["btn_forgethotpixels"].button("option", "disabled", true);
    });
    makeButton("btn_loadhotpixels", function() {
        miscCmd("hotpixels_load");
    });
}

function hotpixelsInfoUpdate(obj)
{
    var ele = document.getElementById("hotpixel_info");
    if ((obj !== undefined && typeof obj !== 'undefined') == false) {
        ele.innerHTML = "no data available";
        ui_list["btn_hotpixels"]      .button("option", "disabled", false);
        ui_list["btn_forgethotpixels"].button("option", "disabled", true);
        ui_list["btn_loadhotpixels"]  .button("option", "disabled", false);
        return;
    }
    if (('hotpix' in obj) == false)
    {
        ele.innerHTML = "no hot-pixel info available";
        ui_list["btn_hotpixels"]      .button("option", "disabled", false);
        ui_list["btn_forgethotpixels"].button("option", "disabled", true);
        ui_list["btn_loadhotpixels"]  .button("option", "disabled", false);
        return;
    }
    if (obj["hotpix"] == false || obj["hotpix"] == null)
    {
        ele.innerHTML = "no hot-pixels";
        ui_list["btn_hotpixels"]      .button("option", "disabled", false);
        ui_list["btn_forgethotpixels"].button("option", "disabled", true);
        ui_list["btn_loadhotpixels"]  .button("option", "disabled", false);
        return;
    }
    var cnt = obj["hotpix_cnt"];
    if (obj["hotpix_used"] != false)
    {
        ele.innerHTML = cnt.toString() + " hot-pixels being used. Currently removing " + obj["hotpix_last"].toString() + " false stars.";
        ui_list["btn_hotpixels"]      .button("option", "disabled", true);
        ui_list["btn_forgethotpixels"].button("option", "disabled", false);
        ui_list["btn_loadhotpixels"]  .button("option", "disabled", true);
    }
    else
    {
        ele.innerHTML = cnt.toString() + " hot-pixels in the file, ";
        if (cnt != 0) { ele.innerHTML += "but "; }
        ele.innerHTML += "not being used.";
        if (cnt != 0) { ele.innerHTML += " Press \"load file\" to utilize."; }
        ui_list["btn_hotpixels"]      .button("option", "disabled", false);
        ui_list["btn_forgethotpixels"].button("option", "disabled", true);
        ui_list["btn_loadhotpixels"]  .button("option", "disabled", false);
    }
}

    </script>
    <p>If the camera gets too hot, there will be pixels that appear to be stuck as white. These stuck pixels will be falsely detected as stars. You will notice these pixels when you see stars that do not move even though you are moving the camera around.</p>
    <p>It is possible to memorize which pixels are stuck so that they are removed from the list of stars. To do so: <ol><li>turn up the guide-cam gain and guide-cam shutter time slightly</li><li>cover up the guide-camera completely</li><li>click the "capture" button</li><li>restore your original guide-cam settings</li></ol></p>
    <p>Think of this as taking a "dark frame" but not really the same thing.</p>

    <div class="divTable">
        <div class="divTableBody">
            <div class="divTableRow">
                <div class="divTableCell"><button id="btn_hotpixels">Capture</button></div>
                <div class="divTableCell divTableCellFill">&nbsp;</div>
                <div class="divTableCell"><button id="btn_forgethotpixels">Forget</button></div>
                <div class="divTableCell divTableCellFill">&nbsp;</div>
                <div class="divTableCell"><button id="btn_loadhotpixels">Load File</button></div>
            </div>
        </div>
    </div>

    <p><fieldset><legend>Hot Pixel Info</legend><div id="hotpixel_info"></div></fieldset></p>
  </div>
  <h3>Console</h3>
  <div>
    <script type="text/javascript">
function make_ui_console()
{
    makeButton("btn_consoleinput_send", function() {
        var txt = document.getElementById("txt_consoleinput").value.trim();
        console.log("text: " + txt);
        if (txt.length > 0)
        {
            ui_list["btn_consoleinput_send"].button("option", "disabled", true);
            setTimeout(function(){ ui_list["btn_consoleinput_send"].button("option", "disabled", false); }, 2000);
            if (txt.startsWith("toast:")) {
                show_toast_msg(txt.substring(6).trim());
            }
            else if (txt.startsWith("websock:")) {
                websock_send(txt.substring(8).trim());
            }
            else if (txt.startsWith("screensize")) {
                msglog_appendLocal("screen size: " + window.innerWidth + " x " + window.innerHeight);
            }
            else if (txt.startsWith("fakeerrors")) {
                disconnectAndFreeze();
                document.getElementById("loading")                .style.display = "block";
                document.getElementById("loading_failed")         .style.display = "block";
                document.getElementById("loading_connecting")     .style.display = "block";
                document.getElementById("loading_settings")       .style.display = "block";
                document.getElementById("loading_almost")         .style.display = "block";
                document.getElementById("memory_error")           .style.display = "block";
                document.getElementById("camera_hardware_error")  .style.display = "block";
                document.getElementById("mount_hardware_error")   .style.display = "block";
                document.getElementById("guide_panic_error")      .style.display = "block";
                document.getElementById("camera_hardware_wait")   .style.display = "block";
                document.getElementById("connection_lost")        .style.display = "block";
            }
            else
            {
                msglog_append("> " + txt);
                miscCmd(txt);
                if (txt.startsWith("default_settings")) {
                    setTimeout(function() { disconnectAndGo("", 1000); }, 1000);
                }
            }
        }
    });
    //$("#txt_consoleinput").button().addClass('consoleinput-textfield');
    makeButton("btn_consoleclear", function() {
        var date = new Date();
        document.getElementById("div_msglog").innerHTML = "messages cleared at " + fmtDate(date) + " - " + fmtTime(date);
    });

    document.getElementById("txt_consoleinput").addEventListener("keyup", function(event) {
        if (event.keyCode === 13) {
            event.preventDefault();
            document.getElementById("btn_consoleinput_send").click();
        }
    });
}

function msglog_append(txt)
{
    var ele = document.getElementById("div_msglog");
    var old = ele.innerHTML;
    ele.innerHTML = txt + "\r\n<br />\r\n" + old;
}

function msglog_appendLocal(txt)
{
    var ele = document.getElementById("div_msglog");
    var old = ele.innerHTML;
    ele.innerHTML = "[" + fmtTime(new Date()) + "]: " + txt + "\r\n<br />\r\n" + old;
}

    </script>
    <style type="text/css">
.consoleinput-textfield {
    width: 100%;
    font: inherit;
    font-family: monospace;
    color: #000;
    text-align: inherit;
    outline: none;
    cursor: text;
    background-color: #DDD;
}
    </style>
    <fieldset><legend>Input</legend><div><input type="text" id="txt_consoleinput" name="txt_consoleinput" class="consoleinput-textfield" autocapitalize="off" autocomplete="off" /><br /><br /><button id="btn_consoleinput_send">Send</button></div></fieldset>
    <br />

<style type="text/css">
@media only screen and (max-width: 550px) {
    #div_msglog { font-size:8pt; }
}
</style>

    <fieldset><legend>Messages</legend><div id="div_msglog" style="font-family: monospace; color: #8F8;">no messages yet</div><br /><button id="btn_consoleclear">Clear</button></div></fieldset>
  </div>
</div><!-- accordion -->

</div><!-- showme -->
</body>
</html>